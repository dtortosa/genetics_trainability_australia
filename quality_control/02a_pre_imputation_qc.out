
#######################################
#######################################
checking function to print nicely: header 1
#######################################
#######################################

###### checking function to print nicely: header 2 ######

## checking function to print nicely: header 3 ##

# checking function to print nicely: header 4 #

#######################################
#######################################
check behaviour run_bash
#######################################
#######################################

###### see working directory ######
/home/dftortosa/diego_docs/science/other_projects/australian_army_bishop/heavy_analyses/australian_army_bishop/quality_control


###### list files/folders there ######
02a_pre_imputation_qc.out
02bb_pre_imputation_qc_eval_admix_plot.Rout
data
literature
scripts
singularity_containers


#######################################
#######################################
starting with the pre-imputation QC using 28 cores 
#######################################
#######################################

###### merging batches ######

## check we have 216 and 1242 samples for batch 1 and 2 (batch 2 lost 6 samples that were duplicated), respectively looking at the merged fam file of each batch and the list of samples to be merged ##
TRUE

TRUE


## create new folders to store files ##
total 8
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 20 21:39 data_to_merge
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 20 21:40 merged_plink_files


## copy the plink files of both batches ##
total 97660
-rw-r--r-- 1 dftortosa dftortosa 13585705 Dec 21 13:03 ILGSA24-17303_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  6354595 Dec 21 13:03 ILGSA24-17303_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     1108 Dec 21 13:03 ILGSA24-17303_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa   457913 Dec 21 13:03 ILGSA24-17303_merged_data.log
-rw-r--r-- 1 dftortosa dftortosa 72767656 Dec 21 13:03 ILGSA24-17873_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  6349290 Dec 21 13:03 ILGSA24-17873_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     5854 Dec 21 13:03 ILGSA24-17873_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa   457914 Dec 21 13:03 ILGSA24-17873_merged_data.log
-rw-rw-r-- 1 dftortosa dftortosa       52 Dec 20 21:39 list_files_to_merge.txt


## create a .txt with the name of the plink inputs for each batch ##
total 97660
-rw-r--r-- 1 dftortosa dftortosa 13585705 Dec 21 13:03 ILGSA24-17303_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  6354595 Dec 21 13:03 ILGSA24-17303_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     1108 Dec 21 13:03 ILGSA24-17303_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa   457913 Dec 21 13:03 ILGSA24-17303_merged_data.log
-rw-r--r-- 1 dftortosa dftortosa 72767656 Dec 21 13:03 ILGSA24-17873_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  6349290 Dec 21 13:03 ILGSA24-17873_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     5854 Dec 21 13:03 ILGSA24-17873_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa   457914 Dec 21 13:03 ILGSA24-17873_merged_data.log
-rw-rw-r-- 1 dftortosa dftortosa       52 Dec 21 13:03 list_files_to_merge.txt
ILGSA24-17303_merged_data
ILGSA24-17873_merged_data


## decompress the plink inputs ##
total 369792
-rw-r--r-- 1 dftortosa dftortosa  35317461 Dec 21 13:03 ILGSA24-17303_merged_data.bed
-rw-r--r-- 1 dftortosa dftortosa  13585705 Dec 21 13:03 ILGSA24-17303_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  19936667 Dec 21 13:03 ILGSA24-17303_merged_data.bim
-rw-r--r-- 1 dftortosa dftortosa   6354595 Dec 21 13:03 ILGSA24-17303_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa      8424 Dec 21 13:03 ILGSA24-17303_merged_data.fam
-rw-r--r-- 1 dftortosa dftortosa      1108 Dec 21 13:03 ILGSA24-17303_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa    457913 Dec 21 13:03 ILGSA24-17303_merged_data.log
-rw-r--r-- 1 dftortosa dftortosa 203402400 Dec 21 13:03 ILGSA24-17873_merged_data.bed
-rw-r--r-- 1 dftortosa dftortosa  72767656 Dec 21 13:03 ILGSA24-17873_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  19936667 Dec 21 13:03 ILGSA24-17873_merged_data.bim
-rw-r--r-- 1 dftortosa dftortosa   6349290 Dec 21 13:03 ILGSA24-17873_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     48438 Dec 21 13:03 ILGSA24-17873_merged_data.fam
-rw-r--r-- 1 dftortosa dftortosa      5854 Dec 21 13:03 ILGSA24-17873_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa    457914 Dec 21 13:03 ILGSA24-17873_merged_data.log
-rw-rw-r-- 1 dftortosa dftortosa        52 Dec 21 13:03 list_files_to_merge.txt


## merge the two batches using two different approaches in plink: --merge-list and --bmerge ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ../merged_plink_files/merged_batches.log.
Options in effect:
  --merge-list ./list_files_to_merge.txt
  --out ../merged_plink_files/merged_batches

63997 MB RAM detected; reserving 31998 MB for main workspace.
Performing single-pass merge (1458 people, 654027 variants).

Pass 1: fileset #1 complete.
                                              
Merged fileset written to ../merged_plink_files/merged_batches.bed +
../merged_plink_files/merged_batches.bim +
../merged_plink_files/merged_batches.fam .

Warning: Variants 'rs387907306.1' and 'rs387907306' have the same position.
Warning: Variants 'rs113445782' and 'GSA-rs113445782' have the same position.
Warning: Variants 'rs36083022' and 'GSA-rs36083022' have the same position.
5435 more same-position warnings: see log file.

PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ../merged_plink_files/merged_batches_2.log.
Options in effect:
  --bfile ILGSA24-17303_merged_data
  --bmerge ILGSA24-17873_merged_data
  --out ../merged_plink_files/merged_batches_2

63997 MB RAM detected; reserving 31998 MB for main workspace.
216 people loaded from ILGSA24-17303_merged_data.fam.
1242 people to be merged from ILGSA24-17873_merged_data.fam.
Of these, 1242 are new, while 0 are present in the base dataset.
654027 markers loaded from ILGSA24-17303_merged_data.bim.
654027 markers to be merged from ILGSA24-17873_merged_data.bim.
Of these, 0 are new, while 654027 are present in the base dataset.
Performing single-pass merge (1458 people, 654027 variants).

Pass 1: fileset #1 complete.
                                              
Merged fileset written to ../merged_plink_files/merged_batches_2.bed +
../merged_plink_files/merged_batches_2.bim +
../merged_plink_files/merged_batches_2.fam .

Warning: Variants 'rs387907306.1' and 'rs387907306' have the same position.
Warning: Variants 'rs113445782' and 'GSA-rs113445782' have the same position.
Warning: Variants 'rs36083022' and 'GSA-rs36083022' have the same position.
5435 more same-position warnings: see log file.


## check that merging the two batches with --merge-list and --bmerge gives the same ##
TRUE


## remove the second fileset created only for the check ##
TRUE


## check that the number of unique sample IDs in the merged fam file is equal to the total number of samples, i.e., no ID is duplicated ##
TRUE


## check we do NOT have a .missnp file, where variants with more than two alleles are indicated. We should not have this file ##
TRUE

ls: cannot access '*.missnp': No such file or directory


## check that the bim files (SNP maps) of both batches and the merged file have the same SNPs, although the minor can be different ##
TRUE


## see if the first SNPs that have different minor/major allele between batches are indeed different in terms of frequency and alleles according to plink --freq ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile ./data_to_merge/ILGSA24-17303_merged_data
  --freq

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
216 people (165 males, 17 females, 34 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 216 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.988162.
--freq: Allele frequencies (founders only) written to plink.frq .
 CHR                                             SNP   A1   A2          MAF  NCHROBS
   0                                 GSA-10:47138541    0    C            0      428
   0                                 GSA-rs145797772    A    C     0.006977      430

Warning: 22460 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.

PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile ./data_to_merge/ILGSA24-17873_merged_data
  --freq

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
1242 people (1057 males, 177 females, 8 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1242 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.992153.
--freq: Allele frequencies (founders only) written to plink.frq .
 CHR                                             SNP   A1   A2          MAF  NCHROBS
   0                                 GSA-10:47138541    T    C    0.0008065     2480
   0                                 GSA-rs145797772    0    C            0     2480

Warning: 30972 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.

PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile ./merged_plink_files/merged_batches
  --freq

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.991562.
--freq: Allele frequencies (founders only) written to plink.frq .
 CHR                                             SNP   A1   A2          MAF  NCHROBS
   0                                 GSA-10:47138541    T    C    0.0006878     2908
   0                                 GSA-rs145797772    A    C     0.001031     2910

Warning: 53432 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## remove freq files ##
total 8
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:03 data_to_merge
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:03 merged_plink_files


## compress the merged files ##
total 355612
-rw-rw-r-- 1 dftortosa dftortosa  86364095 Dec 21 13:03 merged_batches.bed.gz
-rw-rw-r-- 1 dftortosa dftortosa   6340275 Dec 21 13:03 merged_batches.bim.gz
-rw-rw-r-- 1 dftortosa dftortosa      7003 Dec 21 13:03 merged_batches.fam.gz
-rw-rw-r-- 1 dftortosa dftortosa    457962 Dec 21 13:03 merged_batches.log
-rw-r--r-- 1 dftortosa dftortosa 143931915 Dec 20 21:39 plink.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa   2184602 Dec 20 21:39 plink.hh
-rw-r--r-- 1 dftortosa dftortosa    105048 Dec 20 21:39 plink.imiss
-rw-r--r-- 1 dftortosa dftortosa  52439486 Dec 20 21:39 plink.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1197 Dec 20 21:39 plink.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 20 21:39 plink.nosex
-rw-rw-r-- 1 dftortosa dftortosa  72219200 Dec 20 21:39 plink_awk_processed.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa     77140 Dec 20 21:39 plink_awk_processed.imiss


###### remove the decompressed input files ######
total 97660
-rw-r--r-- 1 dftortosa dftortosa 13585705 Dec 21 13:03 ILGSA24-17303_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  6354595 Dec 21 13:03 ILGSA24-17303_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     1108 Dec 21 13:03 ILGSA24-17303_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa   457913 Dec 21 13:03 ILGSA24-17303_merged_data.log
-rw-r--r-- 1 dftortosa dftortosa 72767656 Dec 21 13:03 ILGSA24-17873_merged_data.bed.gz
-rw-r--r-- 1 dftortosa dftortosa  6349290 Dec 21 13:03 ILGSA24-17873_merged_data.bim.gz
-rw-r--r-- 1 dftortosa dftortosa     5854 Dec 21 13:03 ILGSA24-17873_merged_data.fam.gz
-rw-r--r-- 1 dftortosa dftortosa   457914 Dec 21 13:03 ILGSA24-17873_merged_data.log
-rw-rw-r-- 1 dftortosa dftortosa       52 Dec 21 13:03 list_files_to_merge.txt


## check again we have the exact sum of samples from both batches ##
TRUE


## check again after merging we still have 654027 snps, and this is the number of variants than in each of the batches ##
TRUE


###### do some checks on the plink files of the batch ######

## perform missing report with the merged data ##

# calculate missing reports of the plink file sets generated in the previous step #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile ./merged_batches
  --missing

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.991562.
--missing: Sample missing data report written to plink.imiss, and variant-based
missing data report written to plink.lmiss.
total 608272
-rw-rw-r-- 1 dftortosa dftortosa 238719858 Dec 21 13:03 merged_batches.bed
-rw-rw-r-- 1 dftortosa dftortosa  86364095 Dec 21 13:03 merged_batches.bed.gz
-rw-rw-r-- 1 dftortosa dftortosa  19936667 Dec 21 13:03 merged_batches.bim
-rw-rw-r-- 1 dftortosa dftortosa   6340275 Dec 21 13:03 merged_batches.bim.gz
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:03 merged_batches.fam
-rw-rw-r-- 1 dftortosa dftortosa      7003 Dec 21 13:03 merged_batches.fam.gz
-rw-rw-r-- 1 dftortosa dftortosa    457962 Dec 21 13:03 merged_batches.log
-rw-r--r-- 1 dftortosa dftortosa 143931915 Dec 20 21:39 plink.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa   2184602 Dec 21 13:03 plink.hh
-rw-r--r-- 1 dftortosa dftortosa    105048 Dec 21 13:03 plink.imiss
-rw-r--r-- 1 dftortosa dftortosa  52439486 Dec 21 13:03 plink.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1192 Dec 21 13:03 plink.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:03 plink.nosex
-rw-rw-r-- 1 dftortosa dftortosa  72219200 Dec 20 21:39 plink_awk_processed.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa     77140 Dec 20 21:39 plink_awk_processed.imiss

gzip: ./merged_batches.log: unknown suffix -- ignored
Warning: 53432 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# see first rows of the missing report for samples #
                   FID        IID MISS_PHENO   N_MISS   N_GENO   F_MISS
  combat_ILGSA24-17303   0200ADMM          Y     4314   654027 0.006596
  combat_ILGSA24-17303   0200ASJM          Y     4268   649889 0.006567
  combat_ILGSA24-17303   0200BHNM          Y     4416   649889 0.006795
  combat_ILGSA24-17303   0200CBOM          Y     4997   654027  0.00764
  combat_ILGSA24-17303   0200CDFM          Y     4302   649889  0.00662
  combat_ILGSA24-17303   0200CDJM          Y     4277   649889 0.006581
  combat_ILGSA24-17303   0200JCJM          Y     6155   654027 0.009411
  combat_ILGSA24-17303   0200JCMM          Y     4255   654027 0.006506


## check about the number of genotypes in the DNA report file ##

# load the bim file #

# check that the number of variants with 0 for the allele1 and allele2 is 3846 #
the number of SNPs with allele1 and allele1 as zero is 3846, which is exactly the number of SNPs lacking in the sum of SNPs called+non-called of the DNA report for each individual. This explains that this sum does not total to 654027. These cases with allele1 and allele2 as zero cannot have genotypes (there are no alleles), and without genotypes you cannot calculate the GS_score, which is used to determine whether a SNP is called or not.

## check what is going on with the samples in the missing file whose potential number of total SNPs is lower ##

# see the distinct values for the number of potential SNPs across the whole sample missing report #
N_GENO
654027
649889


# process the sample missing file with awk in order to read it with pandas #


# load the missing sample report and the fam file into python #

# check we have the correct number of samples in each batch #
True
True

# calculate the number of variants excluding those in Y chromosome #
649889

# check that the number of unique cases for n_snps in sample missing is only 2, being one the total number of snps and the second the number of snps minus Y snps. Also check that the samples in the missing report with less than 654027 are non-males, because they should not have SNPs in Y chromosome (chromosome 24) #
We do have the expected number of potential genotypes for samples in the missing report according to the number of non-Y variants in non-male samples. Y SNPs in females are obligatory missing, so they are not counted.

## check differences in call rate and MAF between batches. According to Ritchie's tutorial, one simple approach to detect batch effects is to calculate the average minor allele frequency and average genotyping call rate across all SNPs for each batch. Gross differences in either of these on any batch can easily be identified ##

# call rate #
average call rate for batch 1 and 2 is 0.988 and 0.992, respectively
The difference in call rate between batches is 0.004%

# MAF #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile ./merged_batches
  --family
  --freq

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
--family: 2 clusters defined.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.991562.
--freq: Cluster-stratified allele frequencies (founders only) written to
plink.frq.strat .
total 608276
-rw-rw-r-- 1 dftortosa dftortosa 238719858 Dec 21 13:03 merged_batches.bed
-rw-rw-r-- 1 dftortosa dftortosa  86364095 Dec 21 13:03 merged_batches.bed.gz
-rw-rw-r-- 1 dftortosa dftortosa  19936667 Dec 21 13:03 merged_batches.bim
-rw-rw-r-- 1 dftortosa dftortosa   6340275 Dec 21 13:03 merged_batches.bim.gz
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:03 merged_batches.fam
-rw-rw-r-- 1 dftortosa dftortosa      7003 Dec 21 13:03 merged_batches.fam.gz
-rw-rw-r-- 1 dftortosa dftortosa    457962 Dec 21 13:03 merged_batches.log
-rw-r--r-- 1 dftortosa dftortosa 143931915 Dec 21 13:03 plink.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa   2184602 Dec 21 13:03 plink.hh
-rw-r--r-- 1 dftortosa dftortosa    105048 Dec 21 13:03 plink.imiss
-rw-r--r-- 1 dftortosa dftortosa  52439486 Dec 21 13:03 plink.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1197 Dec 21 13:03 plink.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:03 plink.nosex
-rw-rw-r-- 1 dftortosa dftortosa  72219200 Dec 20 21:39 plink_awk_processed.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa     77140 Dec 21 13:03 plink_awk_processed.imiss

Warning: 53432 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.

CHR	SNP	CLST	A1	A2	MAF	MAC	NCHROBS
0	10:86912383	combat_ILGSA24-17303	0	I	0	0	430
0	10:86912383	combat_ILGSA24-17873	0	I	0	0	2482
0	1:145030589	combat_ILGSA24-17303	T	G	0.01408	6	426
0	1:145030589	combat_ILGSA24-17873	T	G	0.01174	29	2470
0	22:24301858_CNV_GSTT2B_Ilmndup1	combat_ILGSA24-17303	0	0	0	0	0
0	22:24301858_CNV_GSTT2B_Ilmndup1	combat_ILGSA24-17873	0	0	0	0	0
0	22:24301858_CNV_GSTT2B_Ilmndup2	combat_ILGSA24-17303	0	0	0	0	0
0	22:24301858_CNV_GSTT2B_Ilmndup2	combat_ILGSA24-17873	0	0	0	0	0
0	22:24301858_CNV_GSTT2B_Ilmndup3	combat_ILGSA24-17303	0	0	0	0	0

average MAF for batch 1 and 2 is 0.122 and 0.12, respectively
The difference in call rate between batches is 0.002%

## check we have the correct number of samples looking at the merged fam file ##
TRUE


## check that we do NOT have the duplicate samples (1100JHJM, 1200JPJM and 7800AGSO) in the second batch ##
TRUE


###### Remove SNPs duplicated. We are going to remove first duplicates because this should not be affected by population structure ######

## check we have 654027 SNPs, saving the number of SNPs into a variable ##
654027

True

## check SNPs IDs are not duplicated, as plink 1.9 does not look for duplicates using the ID ##
TRUE


## check again SNPs IDs are not duplicated using pandas ##

## list duplicated SNPs ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./quality_control/00_snp_duplicates/list_duplicates.log.
Options in effect:
  --bfile ./plink_bed_files/merged_batches/merged_plink_files/merged_batches
  --list-duplicate-vars suppress-first ids-only
  --out ./quality_control/00_snp_duplicates/list_duplicates

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./quality_control/00_snp_duplicates/list_duplicates.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.991562.
654027 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--list-duplicate-vars report written to
./quality_control/00_snp_duplicates/list_duplicates.dupvar .
total 2216
-rw-rw-r-- 1 dftortosa dftortosa   72023 Dec 21 13:03 list_duplicates.dupvar
-rw-rw-r-- 1 dftortosa dftortosa 2184602 Dec 21 13:03 list_duplicates.hh
-rw-rw-r-- 1 dftortosa dftortosa    1439 Dec 21 13:03 list_duplicates.log
-rw-rw-r-- 1 dftortosa dftortosa    1260 Dec 21 13:03 list_duplicates.nosex

Warning: 53432 het. haploid genotypes present (see
./quality_control/00_snp_duplicates/list_duplicates.hh ); many commands treat
these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## load the files with duplicates into pandas ##
                                                      0
0                                  9:136149096-CAGT-CGA
1     GSA-rs142775857 exm1660072 rs184047537 rs20028...
2     22:24301858_CNV_GSTT2B_Ilmndup2 22:24301858_CN...
3     GSA-1:145032464 GSA-1:145066921 GSA-9:40357724...
4     GSA-1:143919714 GSA-1:144087945 GSA-1:14502177...
...                                                 ...
2596                                         exm2216500
2597                                        rs117565943
2598                                         rs35134837
2599                                     exm-rs41378955
2600                                  MTReverseDLOOP_61

[2601 rows x 1 columns]

## the file generated has in each row ALL snps that have the same position and alleles, except the first one, thus, the number of rows it is not the total number of duplicates. Therefore, we need also to know the number of snps in each row. ##
For example: GSA-rs142775857 rs184047537 rs200286606

## see number of plink duplicates ##
3536
The number of duplicates is 0.540650462442682 percent respect to the total number of SNPs

## calculate the number of duplicates with pandas and check is the same than plink duplicates. As we want to consider as duplicates SNPs with the same alleles, irrespectively of the assigment, we need to create a new column where we get both alleles in the same order independently if allele 1 is A or T. Therefore A1=A and A2=T will be the same than A1=T and A2=A, i.e., AT. ##
True

## if there are less than 2% of duplicates, cool, else stop ##
less than 2% of duplicates, good to go!

## filter these snps ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates.log.
Options in effect:
  --bfile ./plink_bed_files/merged_batches/merged_plink_files/merged_batches
  --exclude ./quality_control/00_snp_duplicates/list_duplicates.dupvar
  --make-bed
  --out ./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates

63997 MB RAM detected; reserving 31998 MB for main workspace.
654027 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates.nosex .
--exclude: 650491 variants remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.993691.
650491 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates.bed +
./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates.bim +
./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates.fam ...
0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 255596
-rw-rw-r-- 1 dftortosa dftortosa     72023 Dec 21 13:03 list_duplicates.dupvar
-rw-rw-r-- 1 dftortosa dftortosa   2184602 Dec 21 13:03 list_duplicates.hh
-rw-rw-r-- 1 dftortosa dftortosa      1439 Dec 21 13:03 list_duplicates.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:03 list_duplicates.nosex
-rw-rw-r-- 1 dftortosa dftortosa 237429218 Dec 21 13:04 merged_batches_no_snp_duplicates.bed
-rw-rw-r-- 1 dftortosa dftortosa  19803358 Dec 21 13:04 merged_batches_no_snp_duplicates.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_no_snp_duplicates.fam
-rw-rw-r-- 1 dftortosa dftortosa   2155413 Dec 21 13:04 merged_batches_no_snp_duplicates.hh
-rw-rw-r-- 1 dftortosa dftortosa      1710 Dec 21 13:04 merged_batches_no_snp_duplicates.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_no_snp_duplicates.nosex

Warning: 52716 het. haploid genotypes present (see
./quality_control/00_snp_duplicates/merged_batches_no_snp_duplicates.hh ); many
commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


###### remove the non-compressed fileset of the input folder ######
total 355620
-rw-rw-r-- 1 dftortosa dftortosa  86364095 Dec 21 13:03 merged_batches.bed.gz
-rw-rw-r-- 1 dftortosa dftortosa   6340275 Dec 21 13:03 merged_batches.bim.gz
-rw-rw-r-- 1 dftortosa dftortosa      7003 Dec 21 13:03 merged_batches.fam.gz
-rw-rw-r-- 1 dftortosa dftortosa    457962 Dec 21 13:03 merged_batches.log
-rw-r--r-- 1 dftortosa dftortosa 143931915 Dec 21 13:03 plink.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa   2184602 Dec 21 13:03 plink.hh
-rw-r--r-- 1 dftortosa dftortosa    105048 Dec 21 13:03 plink.imiss
-rw-r--r-- 1 dftortosa dftortosa  52439486 Dec 21 13:03 plink.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1197 Dec 21 13:03 plink.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:03 plink.nosex
-rw-rw-r-- 1 dftortosa dftortosa  72219200 Dec 21 13:03 plink_awk_processed.frq.strat
-rw-rw-r-- 1 dftortosa dftortosa     77140 Dec 21 13:03 plink_awk_processed.imiss


## check again for duplicates ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./check_no_duplicates/check_duplicates.log.
Options in effect:
  --bfile ./merged_batches_no_snp_duplicates
  --list-duplicate-vars suppress-first ids-only
  --out ./check_no_duplicates/check_duplicates

63997 MB RAM detected; reserving 31998 MB for main workspace.
650491 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to ./check_no_duplicates/check_duplicates.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.993691.
650491 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--list-duplicate-vars report written to
./check_no_duplicates/check_duplicates.dupvar .
total 2116
-rw-rw-r-- 1 dftortosa dftortosa       0 Dec 21 13:04 check_duplicates.dupvar
-rw-rw-r-- 1 dftortosa dftortosa 2155413 Dec 21 13:04 check_duplicates.hh
-rw-rw-r-- 1 dftortosa dftortosa    1389 Dec 21 13:04 check_duplicates.log
-rw-rw-r-- 1 dftortosa dftortosa    1260 Dec 21 13:04 check_duplicates.nosex

Warning: 52716 het. haploid genotypes present (see
./check_no_duplicates/check_duplicates.hh ); many commands treat these as
missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## Do we have zero duplicated positions after filtering? ##
TRUE


## load the bim file after removing duplicates ##
         0                                1  2      3  4  5
0        0                      10:86912383  0      0  0  I
1        0                      1:145030589  0      0  T  G
2        0  22:24301858_CNV_GSTT2B_Ilmndup1  0      0  0  0
3        0                  GSA-10:47138541  0      0  T  C
4        0                  GSA-10:47146867  0      0  A  G
...     ..                              ... ..    ... .. ..
650486  26                      rs142662828  0  16456  A  G
650487  26                       chrM_16465  0  16465  T  C
650488  26                        200610-37  0  16482  G  A
650489  26                        rs3937033  0  16519  T  C
650490  26                      rs386829316  0  16527  T  C

[650491 rows x 6 columns]

## check that the IDs in the original bim file after excluding pandas dups are the same than the remaining IDs in the new bim file obtained with plink ##
True

## check that we do not have any NA in the SNP IDs in the cleaned bim file ##
We do NOT have NA in SNP IDs, so good to go!

###### filter SNPs by chromosome type ######

## create folder to do operations ##
total 8
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering


## see the unique chromosome names in the SNP map ##

# select the name of the zip file with batch data based on the batch name because ILGSA24-17873 is called CAGRF20093767.zip, not ILGSA24-17873.zip #

# ILGSA24-17873: starting #
zip name is: CAGRF20093767

# ILGSA24-17873: load zip info from the zip file #

# ILGSA24-17873: extract the zipinfo of the SNP_map #
<ZipInfo filename='SNP_Map.txt' compress_type=deflate external_attr=0x20 file_size=36706614 compress_size=10781991>

# ILGSA24-17873: extract the SNP map #

# ILGSA24-17873: add batch name to the SNP map file #
total 35848
-rw-rw-r-- 1 dftortosa dftortosa 36706614 Dec 21 13:04 ILGSA24-17873_SNP_Map.txt


# ILGSA24-17303: starting #
zip name is: ILGSA24-17303

# ILGSA24-17303: load zip info from the zip file #

# ILGSA24-17303: extract the zipinfo of the SNP_map #
<ZipInfo filename='SNP_Map.txt' compress_type=deflate filemode='-rw-rw-r--' file_size=36706614 compress_size=10663453>

# ILGSA24-17303: extract the SNP map #

# ILGSA24-17303: add batch name to the SNP map file #
total 71696
-rw-rw-r-- 1 dftortosa dftortosa 36706614 Dec 21 13:04 ILGSA24-17303_SNP_Map.txt
-rw-rw-r-- 1 dftortosa dftortosa 36706614 Dec 21 13:04 ILGSA24-17873_SNP_Map.txt


# check both SNP maps identical #
Index	Name	Chromosome	Position	GenTrain Score	SNP	ILMN Strand	Customer Strand	NormID
1	1:103380393	1	102914837	0.7987	[T/C]	BOT	TOP	28
2	1:109439680	1	108897058	0.8792	[A/G]	TOP	TOP	1
3	1:110198788	1	109656166	0.8780	[T/C]	BOT	BOT	4
4	1:110201112	1	109658490	0.8584	[G/C]	BOT	TOP	101
5	1:110201667	1	109659045	0.7815	[T/C]	BOT	BOT	1
6	1:110202904	1	109660282	0.8816	[A/G]	TOP	BOT	1
7	1:110203240	1	109660618	0.7256	[A/C]	TOP	BOT	3
8	1:110203911	1	109661289	0.6915	[T/C]	BOT	BOT	1
9	1:110206675	1	109664053	0.8811	[T/C]	BOT	TOP	1
Index	Name	Chromosome	Position	GenTrain Score	SNP	ILMN Strand	Customer Strand	NormID
1	1:103380393	1	102914837	0.7987	[T/C]	BOT	TOP	28
2	1:109439680	1	108897058	0.8792	[A/G]	TOP	TOP	1
3	1:110198788	1	109656166	0.8780	[T/C]	BOT	BOT	4
4	1:110201112	1	109658490	0.8584	[G/C]	BOT	TOP	101
5	1:110201667	1	109659045	0.7815	[T/C]	BOT	BOT	1
6	1:110202904	1	109660282	0.8816	[A/G]	TOP	BOT	1
7	1:110203240	1	109660618	0.7256	[A/C]	TOP	BOT	3
8	1:110203911	1	109661289	0.6915	[T/C]	BOT	BOT	1
9	1:110206675	1	109664053	0.8811	[T/C]	BOT	TOP	1
TRUE


# remove the map of one batch are retain just one to do heck as they are identical #
total 35848
-rw-rw-r-- 1 dftortosa dftortosa 36706614 Dec 21 13:04 SNP_Map.txt


# extract the unique chromosome names using awk #
1
0
10
11
12
13
14
15
16
17
18
19
6
2
20
MT
Y
21
22
5
7
4
3
8
9
X
XY


# split the string generated with the awk unique chromsome names using '
', but avoid the last element which is the last empty line, then order using natural sorting #
['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', 'MT', 'X', 'XY', 'Y']

# create a list with the expected chromosome names, i.e., unknown (0), 22 autosomals, mito, sex and pseudo-autosomal #

# check we have the expect unique chromosome names #
True

# check again we have the expect unique chromosome names using pandas this time #
True

## we will use an empty list to save the IDs of the SNPs with strange chromosomes, then use plink to exclude ##
[]

## explore chromosome 0 ##

# check we have 0 chromosome in the SNP_map #
True

# check 0 in plink is 0 in illumina snp_map #
True

# count SNPs for which we have 0 chromosome #
We have 11 SNPs with chromosome zero
we have less than 50 variants with chromosome zero, no problem! add them to the list to SNPs to be excluded
['10:86912383', '1:145030589', '22:24301858_CNV_GSTT2B_Ilmndup1', 'GSA-10:47138541', 'GSA-10:47146867', 'GSA-1:144865278', 'GSA-1:148552472', 'GSA-rs3010970', 'Variant15773', 'rs1057517198', 'rs2301953']

## explore SNPs with XY ##

# check we have XY chromosome in the SNP_map #
True

# check 25 in plink is XY in illumina snp_map #
True

# count SNPs for which we have XY chromosome, i.e., pseudo-autosomal #
We have 859 SNPs pseudo-autosomal regions
we have less than 1000 variants in pseudo-autosomal regions, no problem!

## explore SNPs in MT ##

# check we have MT chromosome in the SNP_map #
True

# check 26 in plink is MT in illumina snp_map #
True

# count SNPs for which we have MT chromosome #
We have 1010 SNPs in mito genome
we have less than 1500 variants in mito genome, no problem!

## explore SNPs in X ##

# check we have X chromosome in the SNP_map #
True

# check 23 in plink is X in illumina snp_map #
True

# count SNPs in X #
We have 26781 SNPs in X
we have more than 20000 variants in X, no problem!

## explore SNPs in Y ##

# check we have Y chromosome in the SNP_map #
True

# check 24 in plink is Y in illumina snp_map #
True

# count SNPs in Y #
We have 3843 SNPs in Y
variants in Y are more than 3K and less than 10K, no problem!

## remove selected SNPs ##

# save to a file the list of SNPs to be excluded, each SNP in anew line #
10:86912383
1:145030589
22:24301858_CNV_GSTT2B_Ilmndup1
GSA-10:47138541
GSA-10:47146867
GSA-1:144865278
GSA-1:148552472
GSA-rs3010970
Variant15773
rs1057517198
rs2301953


# exclude these SNPs using --exclude of plink #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./01_chromosome_filtering/merged_batches_filtered_chromosomes.log.
Options in effect:
  --bfile ./00_snp_duplicates/merged_batches_no_snp_duplicates
  --exclude ./01_chromosome_filtering/snps_to_exclude.txt
  --make-bed
  --out ./01_chromosome_filtering/merged_batches_filtered_chromosomes

63997 MB RAM detected; reserving 31998 MB for main workspace.
650491 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./01_chromosome_filtering/merged_batches_filtered_chromosomes.nosex .
--exclude: 650480 variants remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.993693.
650480 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./01_chromosome_filtering/merged_batches_filtered_chromosomes.bed
+ ./01_chromosome_filtering/merged_batches_filtered_chromosomes.bim +
./01_chromosome_filtering/merged_batches_filtered_chromosomes.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 289228
-rw-rw-r-- 1 dftortosa dftortosa  36706614 Dec 21 13:04 SNP_Map.txt
-rw-rw-r-- 1 dftortosa dftortosa 237425203 Dec 21 13:04 merged_batches_filtered_chromosomes.bed
-rw-rw-r-- 1 dftortosa dftortosa  19803078 Dec 21 13:04 merged_batches_filtered_chromosomes.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_filtered_chromosomes.fam
-rw-rw-r-- 1 dftortosa dftortosa   2155413 Dec 21 13:04 merged_batches_filtered_chromosomes.hh
-rw-rw-r-- 1 dftortosa dftortosa      1657 Dec 21 13:04 merged_batches_filtered_chromosomes.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_filtered_chromosomes.nosex
-rw-rw-r-- 1 dftortosa dftortosa       170 Dec 21 13:04 snps_to_exclude.txt

Warning: 52716 het. haploid genotypes present (see
./01_chromosome_filtering/merged_batches_filtered_chromosomes.hh ); many
commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# check that the excluded SNPs are actually out of the new bim file #
True

# check that the number of snps removed from the bim file is the same than the number of snps in the exclusion list #
True

# check that snps present in the first bim file but not in the new one are exactly those of the exclusion list #
True

# check all the unwanted chromosomes are removed #
True
True

# see the remaining chromosomes #
[ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
 25 26]

# check again we do not have duplicated snp ids #
True

###### GeneCall and GeneTrain scores ######

## We are not going to use GeneCall and GeneTrain scores. See script for further details ##

###### check no genetic position in map and select only snps ######

## check no genetic position in the map, it should be 0 always ##
[ True]

## check no SNP has empty ID ##
True
True

## select only SNPs ##

# see unique alleles: we have insertions and deletions (indels) along with 0, which means all samples are major homozigous and no minor allele is present #
['0' 'C' 'A' 'T' 'G' 'D' 'I']
['C' 'T' 'G' 'A' 'I' 'D' '0']

# make new dir #
total 12
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps


# remove non-SNPs #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./02_remove_non_snps/merged_batches_remove_non_snps.log.
Options in effect:
  --bfile ./01_chromosome_filtering/merged_batches_filtered_chromosomes
  --make-bed
  --out ./02_remove_non_snps/merged_batches_remove_non_snps
  --snps-only just-acgt

63997 MB RAM detected; reserving 31998 MB for main workspace.
640897 out of 650480 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./02_remove_non_snps/merged_batches_remove_non_snps.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.993625.
640897 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./02_remove_non_snps/merged_batches_remove_non_snps.bed +
./02_remove_non_snps/merged_batches_remove_non_snps.bim +
./02_remove_non_snps/merged_batches_remove_non_snps.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 249676
-rw-rw-r-- 1 dftortosa dftortosa 233927408 Dec 21 13:04 merged_batches_remove_non_snps.bed
-rw-rw-r-- 1 dftortosa dftortosa  19518309 Dec 21 13:04 merged_batches_remove_non_snps.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_remove_non_snps.fam
-rw-rw-r-- 1 dftortosa dftortosa   2146623 Dec 21 13:04 merged_batches_remove_non_snps.hh
-rw-rw-r-- 1 dftortosa dftortosa      1548 Dec 21 13:04 merged_batches_remove_non_snps.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_remove_non_snps.nosex

Warning: 52506 het. haploid genotypes present (see
./02_remove_non_snps/merged_batches_remove_non_snps.hh ); many commands treat
these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# check no indels are present and we only have ACTG + 0 #
[True, True, True, True, True]
[True, True, True, True, True]
We have lost 9583 rows after removing INDELS

###### remove again duplicates but this time only considering position ######

## see duplicates by position ##
         0              1  2         3  4  5
303      1    rs387907306  0   2228866  A  G
304      1  rs387907306.1  0   2228866  T  G
2955     1     1:11855218  0  11795161  0  A
2956     1    rs121434297  0  11795161  0  T
4007     1     rs497078.1  0  15440540  A  C
...     ..            ... ..       ... .. ..
640605  26    rs368688251  0     12822  G  A
640662  26      200610-69  0     13626  T  C
640663  26    rs376146541  0     13626  A  G
640780  26     exm2216468  0     15257  A  G
640781  26    rs376262718  0     15257  T  C

[2447 rows x 6 columns]

## make new dir ##
total 16
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups


## select those SNPs with the same position ##
['rs387907306.1', 'rs121434297', 'rs497078.2', 'rs587782604.1', 'rs1131691052.2', 'rs387906795.1', 'rs818202', 'rs763494292', 'rs35019869', 'rs2640464', 'rs148412181.1', 'rs137852700.1', 'rs137852700.2', 'rs121918057.1', 'rs587782228.1', 'rs34126013', 'rs121918241.1', 'rs267606962.1', 'rs515726176.2', 'rs56053398.1', 'rs56053398.2', 'rs770273135.1', 'rs2297669.2', 'rs61750562.2', 'rs61749455.1', 'rs748639205.2', 'rs200687447.1', 'rs3918290.1', 'rs3918290.2', 'rs777425216.2', 'rs11555177.2', 'rs4646412', 'rs121434596.1', 'rs121913237.1', 'rs17852419.2', 'rs3748742.2', 'rs3748742.3', 'rs387906613.1', 'rs80356771.1', 'rs80356771.2', 'rs76763715.2', 'rs57966821.2', 'rs139875047.2', 'rs57629361.1', 'rs80338938', 'rs2814778', 'rs121913589.1', 'rs770546306.1', 'rs72549325.1', 'rs72549331.1', 'rs121918207.1', 'rs755796920.1', 'rs189678019.1', 'rs145489194.1', 'rs62635659.1', 'rs80338782.1', 'rs80338778.1', 'rs45525839.1', 'rs397516457.1', 'rs387907033.1', 'rs4149230.2', 'rs367543076.1', 'rs748659198.1', 'rs794728708.1', 'rs794728746.1', 'rs794728756.1', 'rs794728780.1', 'rs121913123.1', 'rs75086406.1', 'rs202166344.1', 'rs121908153.1', 'rs1876482', 'rs387907085.1', 'rs771015234.2', 'rs1799812', 'rs146377316.2', 'rs1801700', 'rs80356585.1', 'rs56175199.2', 'rs148542782.2', 'rs55989760.1', 'rs55771538.2', 'rs397517154.1', 'rs397517150.1', 'rs6756629.1', 'rs11887534.1', 'rs774857058.1', 'rs774857058.2', 'rs63751444.1', 'rs267607689.1', 'rs1114167845.2', 'rs12476364.1', 'rs587779067', 'rs587779067.1', 'rs267607940.1', 'rs151244108.2', 'rs267607949.1', 'rs267607948.1', 'rs267607957.2', 'rs63751207.1', 'rs63751656.1', 'rs267607969.1', 'rs1114167816.2', 'rs63750280.2', 'rs876659961_MNV', 'rs267608001.1', 'rs63751155.1', 'rs267608019.1', 'rs267608017.1', 'rs1114167818.2', 'rs1114167734.2', 'rs750528093.1', 'rs864622435', 'rs587781462.2', 'rs587779923.2', '2:47801001.2', '2:47803418.2', 'rs182024561.2', 'rs63750949.2', 'rs121908960.1', 'rs772624348.1', 'rs4149521', 'rs893793', 'rs549522925.1', 'rs34555492', 'rs794727444.1', 'rs779614747.1', 'rs199727342.1', 'rs764037830.1', 'rs796053014.1', 'rs794726789.1', 'rs542420576.1', 'rs775214722.1', 'rs794726718.1', 'rs767045134.1', 'rs794726742.1', 'rs763400390.1', 'rs794726713.1', 'rs781746113.1', 'rs794726827.1', 'rs794726827.2', 'rs760361423.1', 'rs764444350.1', 'rs80356477.1', 'rs4148770', 'rs35881803', 'rs34442536', 'rs771511344.1', 'rs112240298.1', 'rs756715989.1', 'rs72646850', 'rs769392594.1', 'rs559590585.1', 'rs751502842.1', 'rs746669146.1', 'rs72648987', 'rs763722868.1', 'rs121909398.1', 'rs587779518.2', 'rs587779464.1', 'rs397509370.1', 'rs587779691', 'rs121912914.1', 'rs886038925_mnv', 'rs111505097.2', 'rs80358239.1', 'rs137852752.1', 'rs2043449', 'rs757205958.1', 'rs201716417.1', 'rs201716417.2', 'rs121912595.1', 'rs952718', 'rs72551322.1', 'rs72551322.2', 'rs121908118.1', 'rs397516698.1', 'rs59962885.1', 'rs2234675', 'rs563607795.1', 'rs16828074.1', 'rs28969682.2', 'rs1817154', 'rs28948390.2', 'rs13426130.2', 'rs41264157.2', 'rs35350960.2', 'rs3771341.2', 'rs28946890.2', 'rs2302538', 'rs28934877.1', 'rs28900406.2', 'rs34993780.2', 'rs34116584.2', 'rs34116584.3', 'rs180177227.1', 'rs180177227.2', 'rs121908529.2', 'rs121908527.1', 'rs121908527.2', 'rs17034687.1', '3:10142109.2', 'rs5030829.2', 'rs5030810.1', 'rs5030833.2', 'rs397516826.1', 'rs1344870', 'rs199660234.1', 'rs730880224.1', 'rs63751012.2', 'rs63751012.3', 'rs63750206.1', 'rs267607725.2', 'rs63750266.2', 'rs63750781.1', 'rs267607742.1', 'rs63750866', 'rs193922370.1', 'rs267607755', 'rs267607759.1', 'rs63751711', 'rs267607778.1', 'rs267607784.1', '3:37014489.2', 'rs267607790.1', 'rs267607795.1', 'rs63751194.1', 'rs63750144.1', 'rs63751715.1', 'rs63751715.2', 'rs267607825.1', 'rs746536721.2', 'rs267607837.2', 'rs267607853.2', 'rs63751202.2', 'rs63749900.1', 'rs63751662.1', 'rs267607879.2', 'rs267607884.1', 'rs267607888.1', 'rs267607888.2', 'rs267607889.1', 'rs267607893.2', 'rs267607893.3', 'rs41315493.2', 'rs199473293.1', 'rs199473292.1', 'rs751787337.1', 'rs757843082.1', 'rs794728879.1', 'rs199473606.1', 'rs199473225.1', 'rs199473172.1', 'rs199473144.1', 'rs730880211_MNV', 'rs199473576.1', 'rs3918389.1', 'rs3918389.2', 'rs765669597.2', 'rs387907460.1', 'rs2290547.1', 'rs387907494.1', 'rs756998699.1', 'rs567032648.1', 'rs80338671.1', 'rs2623382', 'rs193922427_MNV', 'rs387907401.1', 'rs115532916.1', 'rs387907297.1', 'rs121908140.1', 'rs121908140.2', 'rs35942089', 'rs762988755.2', 'rs34749281', 'rs11552530.2', 'rs2233463', 'rs121908846.1', 'rs1355366', 'rs77722678.1', 'rs121908321.1', 'rs764719093.1', 'rs74452732.1', 'rs11947105.2', 'rs28672900', 'rs17146904.2', 'rs139309909', 'rs12233719.3', 'rs13123057.2', 'rs7697482.2', 'rs71599906.2', 'rs71599906.3', 'rs41297391.2', 'rs41299994', 'rs74821926.1', 'rs74821926.2', 'rs370520589.3', 'rs2231164', 'rs45605536', 'rs4148157', 'rs2622628', 'rs2231142', 'rs3109823', 'rs2231135', 'rs34592089.2', 'rs28580297.2', 'rs747904021.1', 'rs140948465.1', 'rs121912562.1', 'rs199469664.1', 'rs1554472', 'rs121964955.1', 'rs4742.2', 'rs146494374.1', 'rs870347', 'rs13172324.1', 'rs587783994.1', 'rs104893884.1', 'rs10515115.2', 'rs545185248.1', 'rs2369754', 'rs376213437.2', 'rs376213437.3', 'rs863225365.2', 'rs587779798', 'rs775126020.1', 'rs141582813.2', 'rs559510809.1', 'rs1060503340.1', 'rs1114167599.2', '5:112838797.2', '5:112839421_MNV', 'rs372535376.2', 'rs386134223.1', 'rs776395588.1', 'rs786203805.1', 'rs121909211.1', 'rs121909212.1', 'rs121909212.2', 'rs121908458.1', 'rs104893939.2', 'rs386833493.1', 'rs281864916.1', 'rs390299', 'rs1040045', 'rs597697', 'rs477199', 'rs796024', 'rs669331', 'rs612959', 'rs562777', 'rs112913018.1', 'rs2517922', 'chr6:29816371.1', 'rs1264319', 'rs2259571', 'NEU1:c.808C>T', 'rs28362675.1', 'rs1059615.2', 'rs1042136.1', 'rs121912949.1', 'rs770888294.1', 'rs2229633.1', 'rs121909075.1', 'rs387906837.1', 'rs137852949.1', 'rs137852949.2', 'rs17672049.2', 'rs45479896', 'rs398124581.1', 'rs398124581.2', 'rs387906593.1', 'rs749355583.1', 'rs447818', 'rs201995415.1', 'rs2273827', 'rs34447885.2', 'rs35546288.2', 'rs4646278.2', 'rs34888879.2', 'rs34295611.2', 'rs34059508.1', 'rs35270274.2', 'rs8177507.2', 'rs387907238.1', '7:5978595.2', 'rs778531080.1', 'rs1064794577.2', '7:5995533.2', 'rs763308607.1', 'rs587780059.1', 'rs587779333.1', 'rs935765', 'rs387906596.1', 'rs193921340.1', 'rs193921338.1', 'rs2230445.1', 'rs12537282.2', 'rs752916287.1', 'rs8187801.2', 'rs2230028.2', 'rs3747806', 'rs2229109.1', 'rs28381801', 'rs2230768.2', 'rs28371765', 'rs113667357.2', 'rs4986908.1', 'rs111033205.1', 'rs386833481.1', 'rs1800074.1', 'rs397508285.1', 'rs397508291.1', 'rs397508464.1', 'rs397508490.1', 'rs397508571.1', 'rs397508694.1', 'rs397508720.1', 'rs397508725.1', 'rs397508137.1', 'rs397508222.1', 'rs80055610.1', 'rs397508297.1', 'rs121908748.1', 'rs397508314.1', 'rs397508314.2', 'rs397508316.1', 'rs397508363.1', 'rs397508444.1', 'rs397508465.1', 'rs397508465.2', 'rs397508508.1', 'rs755416052.1', 'rs77902683.1', 'rs77902683.2', 'rs12531711.1', 'rs199422116.1', 'rs397507484.1', 'rs113488022.2', 'rs113488022.3', 'rs397507481.1', 'rs397516904.1', 'rs397507466.1', 'rs387906660.1', 'rs863223895.1', 'rs752550849.1', 'rs776595927.1', 'rs199473000.1', 'rs12720441.1', 'rs199473039.1', 'rs199473039.2', 'rs199473428.2', 'rs199472926.1', 'rs199472926.2', 'rs199473517.1', 'rs199472916.1', 'rs199472914.1', 'rs199472886.1', 'rs199473422.1', 'rs199473421.1', '7:150974856.2', 'rs754921704.1', 'rs754921704.2', 'rs199472839.1', 'rs199472828.1', 'rs104894064.2', 'rs146017816.1', 'rs4986991.2', 'rs55793712.2', 'rs55793712.3', 'rs56387565', 'rs56054745.2', 'HGSNAT:c.1150C>T', 'rs1051660.1', 'rs515726183.1', 'rs199599591.1', 'rs386833592.1', 'rs386833592.2', 'rs587778189.1', 'rs111033656.1', 'rs111033670.1', 'rs111033690.1', 'rs111033722.1', 'rs111033744.2', 'rs111033755.1', 'rs111033808.1', 'rs749047676.1', 'rs387906789.1', 'rs200479612.2', 'rs965897', 'rs864622293', 'rs28933692.1', 'rs137853022.2', 'rs1140064', 'rs754282058.1', 'rs1463729', 'rs3814134', 'rs727504173.1', 'rs773073663.1', 'rs751930594.1', 'rs772370177.1', 'rs118203717.2', 'rs118203447.2', 'rs759183842.1', 'rs118203353.2', 'rs764446683.1', 'rs13297509.1', 'rs386833778.1', 'rs386833778.2', 'rs3780962', 'rs560020203.1', 'rs79781594.1', 'rs79890926.2', 'rs143795581.2', 'rs377767439.2', 'rs55947360.1', 'rs201101792.1', 'rs377767429_mnv', 'rs78347871.1', 'rs200330818.2', 'rs111033260.1', 'rs111033260.2', 'rs376560330.2', 'rs199470473.1', 'rs17851642.2', 'rs140592056', 'rs786201995.1', 'rs786201995.2', 'rs398123317.1', 'rs786202733', 'rs1114167667.2', 'rs786201041.1', 'rs1114167624.2', 'rs1326830', 'rs3814637.1', 'rs17878459.2', 'rs770829708.2', 'rs55640102.2', 'rs564813580.2', 'rs762239445.2', 'rs56165452.2', 'rs28371686.1', 'rs121908386.1', 'rs17222744.2', 'rs4267009.2', 'rs4267009.3', 'rs56199535.1', 'rs56199535.2', 'rs56220353.2', 'rs3740071.2', 'rs3740070.2', 'rs3740070.3', 'rs8187692.1', 'CYP17A1:c.1243+5G>A', 'rs104894144.2', 'rs72559710.2', 'rs55897648.2', 'rs104894226.1', 'rs104894230.1', 'rs104894230.2', 'rs104894229.1', 'rs35705950.1', 'rs179489.1', 'rs199473398.2', 'rs120074178.1', 'rs199472712.1', 'rs120074179.1', 'rs199472722.1', 'rs199472722.2', 'rs199472755.1', 'rs12720459.1', 'rs199472763.3', 'rs199473471.1', 'rs145974930.1', 'rs199472815.1', 'rs33978907.1', 'rs33978907.2', 'rs33919821.2', 'rs33952266.2', 'rs33914668.2', 'rs33913413.1', 'rs33913413.2', 'rs33913413.3', 'rs33914944.1', 'rs33913712.2', 'rs33987903.1', 'rs33987903.2', 'rs11549407.2', 'rs11549407.3', 'rs33974936.1', 'rs33948615.1', 'rs33948615.2', 'rs33943001.2', 'rs35456885.2', 'rs35724775.2', 'rs33915217.2', 'rs33915217.3', 'rs33956879.1', 'rs33971440.2', 'rs33960103.1', 'rs33954632.1', 'rs33954632.2', 'rs35424040.2', 'rs35424040.3', 'rs33950507.1', 'rs33950507.3', 'rs33986703.2', 'rs33986703.3', 'rs33974228.2', 'rs334.2', 'rs334.3', 'rs33983205.1', 'rs33983205.2', 'rs33941849.2', 'rs33941849.3', 'rs33931746.2', 'rs33980857.1', 'rs33980857.2', 'rs33981098.2', 'rs33994806.1', 'rs33994806.3', 'rs33944208.1', 'rs33944208.2', 'rs33944208.3', 'rs120074117.1', 'rs120074117.2', 'rs35098198', 'rs56144125.1', 'rs12161765.2', 'rs74339576.1', 'rs28936370.2', 'rs151344623.1', 'rs151344623.2', 'rs570388861.1', 'rs2074317.2', 'rs2074317.3', 'rs1028564', 'rs387906883.1', 'rs397516020.1', 'rs121909377.2', 'rs397516002.2', 'rs112738974.1', 'rs397515912.1', 'rs193922386.2', 'rs121909254.1', 'rs201108965.1', 'rs11568623.2', 'rs119103258.1', 'rs119103258.2', 'rs1114167477.2', 'rs1114167471.2', 'rs1114167511_mnv', 'rs1063385.1', 'rs11553892.2', 'rs121909768.1', 'rs121909768.2', 'rs80338858.1', 'MYO7A:c.5581C>T', 'rs121908293.1', 'rs2229437.1', 'rs63159160.1', 'rs104894318.1', 'rs2456568.2', 'rs730881359.1', 'rs55861249.1', 'rs749036865.1', 'rs730881348.1', 'rs587781558.1', 'rs587781558.2', 'rs587776549_MNV', 'rs587779866', 'rs17174393.1', 'rs17174393.2', 'rs104894276.2', 'PTS:c.407A>T', 'rs675.1', 'rs397517076.1', 'rs730880056.1', 'rs104895223.1', 'rs104895223.2', 'rs780787386.1', 'rs973934', 'rs55901008.2', 'rs56387224.2', 'rs56199088.2', 'rs2291550', 'rs17851045.2', 'rs121913238.2', 'rs727503110.1', 'rs112445441.2', 'rs112445441.3', 'rs121913529.2', 'rs121913529.3', 'rs745595833.1', 'rs199583774', 'rs200586695', 'rs121918193.1', 'rs121918193.2', 'rs104894331.1', 'rs371712630.2', 'rs61630004', 'rs28933087.1', 'rs150511103.1', 'rs150511103.3', 'rs62638191.1', 'rs62638191.2', 'rs62638193.1', 'rs121917867.1', 'rs62516095.1', 'rs5030849.2', 'rs75193786.2', 'rs75193786.3', 'rs62508575.1', 'rs397516407.1', 'rs397516404.1', 'rs202080221.1', 'rs397507507.1', 'rs397507510.1', 'rs397507514.1', 'rs397507520.1', 'rs397507539.1', 'rs397507539.2', 'rs397507545.1', 'rs80338950.2', 'rs72474224.1', 'rs397508045.1', 'rs397507603.1', 'rs80358507.1', 'rs80358507.2', 'rs81002795.2', 'rs80358726.1', 'rs144848', 'rs397507634.1', 'rs80358579.1', '13:32338134.2', 'rs41293497.1', 'rs56253082.1', 'rs398122558.1', 'rs397507861_MNV', 'rs377698594.2', 'rs397507378.1', 'rs80359009.2', 'rs80359009.3', 'rs1060502459.2', 'rs886038177', 'rs80359018.1', 'rs80359027.1', 'rs81002874.1', 'rs41293513.1', 'rs41293513.2', 'rs730881615_mnv', 'rs80359077.1', 'rs397507404', 'rs80359105.1', 'rs45469092.1', 'rs276174916_mnv', 'rs80359165.1', 'rs886040820_MNV', 'rs886040952_mnv', 'rs80359195.1', 'rs80359195.2', '13:32398161.2', 'rs781641023.1', 'rs387906959.1', 'rs1131690843.2', '13:48362957.2', 'rs121913301', 'rs1131690884.2', 'rs1131690882.2', 'rs76151636.1', 'rs751078884.2', 'rs540935874.2', 'rs777629392.2', '13:51957608.2', 'rs137853284.2', 'rs137853280.2', 'rs104894386.1', 'rs6492764.2', 'rs4148536', 'rs2274407.1', 'rs2274407.2', 'rs4646212', 'rs6046.2', 'rs34116882', 'rs776631057.1', 'rs121908678.2', 'rs146582474.1', 'rs397516253.1', 'rs763538103.1', 'rs370328209.2', 'rs397516233.2', 'rs730880770.1', 'rs758891557.2', 'rs2856897.2', 'rs730880742.1', 'rs727504241.1', 'rs727504272.2', 'rs397516089.1', 'rs397516259.2', 'rs121918731.1', 'rs767983', 'rs387906597.1', 'rs28940314.1', 'rs138495705.1', 'rs7975.3', 'GALC:c.2002A>C', 'rs11623.1', 'rs763801533.1', 'rs121434548.2', 'rs147713329.1', '15:48415566.2', '15:48415572.2', '15:48415723.2', '15:48415758.2', '15:48420764.2', 'rs1085307921.2', '15:48425424.2', '15:48427566.2', 'rs371097218.2', '15:48428396.2', '15:48428460.2', 'rs794728252.2', 'rs794728251.1', '15:48441797.2', '15:48446705.2', '15:48446706.2', '15:48446823.2', '15:48452604.2', '15:48748833', '15:48463898.2', '15:48465789.2', '15:48468504.2', '15:48470745.2', 'rs112375043.2', '15:48474366.2', 'rs1064796522_mnv', 'rs1060501075', 'rs137854456.2', '15:48488419.2', 'rs112202622.1', '15:48492466.2', '15:48492575.2', '15:48492577.2', '15:48492578.2', 'rs794728322', '15:48497272.2', 'rs794728178', '15:48513626.2', '15:48515392.2', '15:48537721.2', '15:48600148.2', '15:48600175.2', 'rs112660651.1', '15:48613046.2', 'rs368764302.2', 'rs28757184', 'rs753780877.1', 'rs200549195.1', 'rs104894483.2', 'rs761628767.1', 'rs28941770.2', 'rs28941770.3', 'rs1823718', 'rs4986873', 'rs1049968.2', 'rs2075590', 'rs2075589', 'rs4986881.2', 'rs56240201.2', 'rs56313657.2', 'rs2069525.2', 'rs2069525.3', 'rs72547512.2', 'rs56107638.2', 'rs762972003.1', 'rs11557300.2', 'rs779007169.1', 'rs1114167465.2', 'rs45517126.1', 'rs45517148.2', 'rs45517148.3', 'rs45509697.2', 'rs45438400.3', 'rs45517206.1', 'rs45437797.1', 'rs45502196.2', 'rs45468292.2', 'rs397515319.2', 'rs45517263.2', 'rs45517268.1', 'rs45517270.2', 'rs397515087.2', 'rs45517289.2', 'rs137854065.1', 'rs45517346.2', '16:2085028.2', 'rs45517358.2', 'rs137854882.2', 'rs45517393.2', 'rs45517395.1', 'rs756181906.1', 'rs28940579.1', 'rs28940579.2', 'rs28940580.1', 'rs28940580.2', 'rs63751325.1', 'rs60791294.1', 'rs63750427.1', 'rs67561842.1', 'rs9930886.1', 'rs753153576.1', 'rs587776417.1', 'rs45494092', 'rs9923231.2', 'rs34667348.1', 'rs6500304.2', 'rs2066845.1', 'rs138043021.2', 'rs368492235.2', 'rs1131341.1', 'rs34278797', 'rs1805007.1', 'rs12948217.2', 'rs121909516.1', 'rs794727773.1', 'rs11575996.2', 'rs587781525.1', 'rs763098116.1', 'rs1057520006.2', 'rs1057520006.3', 'rs1057519988.2', 'rs1057519990', 'rs121912651', 'rs1057520008.1', 'rs28934874.1', 'rs1131691036_mnv', 'rs1057519975.2', 'rs1057519975.3', '17:7675992.2', 'rs786201057.1', 'rs1060501195.2', 'rs769078093.1', 'rs2108978', 'rs786203390.1', 'rs369798171.3', 'rs782460555.1', 'rs104894598.1', 'rs104894598.2', 'rs104894598.3', 'rs2593595', 'rs80356482.1', 'rs80356482.2', 'rs80356487.1', 'rs80356942', 'rs80357069', 'rs878853286_mnv', 'rs80357074.2', 'rs80357442.1', 'rs397507244.2', 'rs80357222.1', 'rs80187739.2', 'rs80358086.1', 'rs80356988.1', 'rs886040240_MNV', 'rs80357389.1', 'rs41293455.1', 'rs397507219.2', 'rs886038025', 'rs799917.3', 'rs886040010_MNV', 'rs4986850.2', 'rs80357118.1', 'rs80357371.1', 'rs397508903.1', 'rs886040899_mnv', 'rs80357244.2', 'rs80357180.2', 'rs886037972', 'rs886040032_mnv', 'rs80357064.1', 'rs80357446.1', 'rs80356880.1', 'rs80358018', 'rs397509332.2', 'rs61732578.1', 'rs61732578.2', 'rs63750959.1', 'rs1003355.2', 'rs756368560.1', 'rs587780875.1', 'rs80338792.2', 'rs121908330.1', 'rs2587507', 'rs28940868.2', 'rs104894637.1', 'rs17555442', 'rs569629', 'rs777286835.1', 'rs985492', 'rs34315917', 'rs112675807.2', 'rs730881969.1', 'rs730881970.1', 'rs121913315.1', 'rs121913322.2', 'rs121913322.3', 'rs864622488', 'rs767399782.1', 'rs944580031.2', 'rs879254411_mnv', 'rs879254498.2', 'rs879254541', 'rs1131692196.2', 'rs879254628_MNV', 'rs879254652.2', 'rs879254668.2', 'rs730882089.2', '19:11110698.2', 'rs544453230.1', 'rs879254758_mnv', 'rs879254771.2', 'rs879254774.2', 'rs368708058.2', 'rs879254887_MNV', 'rs879254907.2', 'rs879254985', 'rs730882109.1', '19:11116910.2', 'rs879255025.2', 'rs879255054.2', 'rs121434373.2', 'rs121434371.2', 'rs3810364', 'rs121918592.2', 'rs193922764.2', 'rs118192162.1', 'rs193922772.1', 'rs919322708.2', 'rs369466056.2', 'rs118192177.1', 'rs28933396.1', 'rs118192178.1', 'rs6413474', '19:41352808_CNV_CYP2A6', 'rs28399442.2', 'rs35303484.1', 'rs45459594.2', 'rs12721646.1', 'rs12721646.2', 'rs80356537.1', 'rs104894680.1', 'rs11569679', 'rs11569680.2', 'rs11569680.3', 'rs121434561', 'rs727503504.1', 'rs397516354.1', 'rs74315418.1', 'rs143383', 'rs2232583.2', 'rs149718395.1', 'rs149718395.2', 'rs11554273.1', 'rs11554273.2', 'rs6090151.2', 'rs759584387.1', 'rs797044938.1', 'rs796052625.1', 'rs771298943.1', 'rs770095972.1', 'rs121964964.1', 'rs121964964.2', 'rs121434254.1', 'rs4818.2', 'rs730881687.1', 'rs780872661.2', '22:29658265.2', 'rs199935023.1', 'rs121434533', 'rs121434529', '22:42477725_CYP2D6', 'rs28371736.2', 'rs28371736.2_CYP2D6', 'rs75467367', 'rs1135838_CYP2D6', 'rs1135832.3', 'rs28371732', 'rs28371729_CYP2D6', 'rs77312092.2', 'rs267608295.2_CYP2D6', 'rs148250267', 'rs79738337_CYP2D6', 'rs5030865.2', 'rs199849357_CYP2D6', 'rs267608289_CYP2D6', 'rs76187628', 'rs267608309', 'rs35046171_CYP2D6', 'rs1080983', '22:42536294-GA_CYP2D6', 'kgp7804958_CYP2D6', 'kgp15077039_CYP2D6', 'JHU_22.42539231_CYP2D6', 'rs797044454.1', 'rs74315478.1', 'rs74315478.2', 'rs80338819.2', 'rs2228431', 'Variant67151', 'rs2407834', 'rs2317327', 'rs61753174.2', 'rs61753164.1', 'rs61752158.2', 'rs1801161.2', 'rs104894934.2', 'rs104894928.2', 'rs137853259', 'rs922257', 'rs144970500.2', 'rs1921917', 'rs1444718', 'rs28940302.2', 'rs398123834.1', 'rs398123834.2', 'rs398124094.1', 'rs1800279', 'rs1800278', 'rs398124036', 'rs398124008.2', 'rs142814364', 'rs1801187', 'rs398123921.2', 'rs398123918.2', 'rs398123908.1', 'rs201366610.1', 'rs398123876.2', 'rs398123872.2', 'variant.107892', 'rs398123852.2', 'rs2194610', 'Variant67198', 'rs62640592.2', 'rs66550389.2', 'rs66550389.3', 'rs68026851', 'rs67367843.1', 'rs104894867', 'rs104894874', 'rs757027813.1', 'rs104894800', 'rs3027471', 'rs137852304', 'rs200220547.2', 'rs727504814.1', 'rs397516675.1', 'X:70329158', 'rs80338758', 'Variant67306', 'rs1340989', 'rs122445112', 'rs3827440', 'rs600977', 'rs143963614', 'exm-rs525869', 'rs2782723', 'rs149059579', 'rs756414485.1', 'rs104894770', 'rs398123224.1', 'rs398123224.2', 'rs869312427.2', 'rs869312402.2', 'rs869312399.2', 'rs397515874.2', 'newrs138886989', 'rs5945037.2', 'kgp30954619', 'rs72554660.2', 'rs80338676', 'var_X_107938639', 'rs587783568.2', 'rs587783563.1', 'rs398122394', 'rs2497538', 'exm1654177', 'rs2843594', 'rs3761555', 'rs502434', 'rs2356746', 'rs240170', 'rs864538', 'rs146235294.2', 'rs147038228.2', 'rs602930', 'rs1575093', 'rs104894863', 'exm-rs530501', 'rs113993953.1', 'rs567517', 'rs587783796.1', 'rs398123113.1', 'rs398123113.2', 'Variant67440', 'rs61751443.1', 'rs61749746.2', 'rs61749739.1', 'rs61749739.2', 'rs61748381', 'rs61748408.1', 'rs61755763.2', 'rs61754457.2', 'rs11549300.2', 'rs72554664', 'rs72554665.1', 'rs72554665.2', 'rs137852317', 'rs2230037', 'rs137852321', 'rs137852329', 'rs137852328.2', 'rs5030868', 'rs137852331', 'rs137852314', 'rs1050829', 'rs1050828', 'rs137852315', 'rs28933668.2', 'rs2058276', 'rs377553396', 'rs768983', 'rs534624521.2', 'rs3853052', 'rs3853054', 'exm-rs1236440', 'Y:15591446-C-G', 'rs373831864.2', 'rs574492814.2', 'Y:19105726-A-C', 'Y:19538933-T-C', 'rs9786805', 'rs3848982', 'rs371933901', 'rs3905', 'Y:21765763-A-G', 'rs871626', 'rs1276035', 'rs1276034', 'rs1276032', 'w23000898302', 'rs3924295', 'rs312259', 'rs2376574', 'rs28527344.2', 'exm2216260', 'exm2216261', 'rs369195256', 'rs374227446', 'rs386420007', 'rs371360308', 'exm2216303', 'rs386420010', 'rs28461189.2', 'rs374549428', 'rs373105186', 'rs376130276', 'rs367951226', 'rs367621332', 'rs368709860', 'rs386419997', 'rs372532331', 'rs373240586', 'rs3088053', 'rs368688251', 'rs376146541', 'rs376262718']

## check the number of SNPs with this problem ##
We have 1276 snps with duplicated position

## save as txt ##
rs387907306.1
rs121434297
rs497078.2
rs587782604.1
rs1131691052.2
rs387906795.1
rs818202
rs763494292
rs35019869
rs2640464


## check we have the correct number of SNPs in the list ##
TRUE


## remove these SNPs ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./03_remove_pos_dups/merged_batches_remove_dup_pos.log.
Options in effect:
  --bfile ./02_remove_non_snps/merged_batches_remove_non_snps
  --exclude ./03_remove_pos_dups/snps_pos_dup.txt
  --make-bed
  --out ./03_remove_pos_dups/merged_batches_remove_dup_pos

63997 MB RAM detected; reserving 31998 MB for main workspace.
640897 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./03_remove_pos_dups/merged_batches_remove_dup_pos.nosex .
--exclude: 639621 variants remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.993621.
639621 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./03_remove_pos_dups/merged_batches_remove_dup_pos.bed +
./03_remove_pos_dups/merged_batches_remove_dup_pos.bim +
./03_remove_pos_dups/merged_batches_remove_dup_pos.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 249192
-rw-rw-r-- 1 dftortosa dftortosa 233461668 Dec 21 13:04 merged_batches_remove_dup_pos.bed
-rw-rw-r-- 1 dftortosa dftortosa  19478970 Dec 21 13:04 merged_batches_remove_dup_pos.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_remove_dup_pos.fam
-rw-rw-r-- 1 dftortosa dftortosa   2139848 Dec 21 13:04 merged_batches_remove_dup_pos.hh
-rw-rw-r-- 1 dftortosa dftortosa      1582 Dec 21 13:04 merged_batches_remove_dup_pos.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_remove_dup_pos.nosex
-rw-rw-r-- 1 dftortosa dftortosa     16779 Dec 21 13:04 snps_pos_dup.txt

Warning: 52344 het. haploid genotypes present (see
./03_remove_pos_dups/merged_batches_remove_dup_pos.hh ); many commands treat
these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check for pos dups after filtering ##

# load the bim file after filtering #
         0                1  2       3  4  5
0        1        rs9651229  0  632287  0  C
1        1        rs9701872  0  632828  C  T
2        1       rs11497407  0  633147  A  G
3        1  GSA-rs116587930  0  792461  A  G
4        1        rs3131972  0  817341  T  C
...     ..              ... ..     ... .. ..
639616  26      rs142662828  0   16456  A  G
639617  26       chrM_16465  0   16465  T  C
639618  26        200610-37  0   16482  G  A
639619  26        rs3937033  0   16519  T  C
639620  26      rs386829316  0   16527  T  C

[639621 rows x 6 columns]

# check for position duplicates #
True

## check also for duplicates in ID ##
True

###### MAF filtering ######
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./04_remove_low_maf_snps/merged_batches_remove_low_maf.log.
Options in effect:
  --bfile ./03_remove_pos_dups/merged_batches_remove_dup_pos
  --maf 0.05
  --make-bed
  --out ./04_remove_low_maf_snps/merged_batches_remove_low_maf

63997 MB RAM detected; reserving 31998 MB for main workspace.
639621 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./04_remove_low_maf_snps/merged_batches_remove_low_maf.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.993621.
339759 variants removed due to minor allele threshold(s)
(--maf/--max-maf/--mac/--max-mac).
299862 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./04_remove_low_maf_snps/merged_batches_remove_low_maf.bed +
./04_remove_low_maf_snps/merged_batches_remove_low_maf.bim +
./04_remove_low_maf_snps/merged_batches_remove_low_maf.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 117532
-rw-rw-r-- 1 dftortosa dftortosa 109449633 Dec 21 13:04 merged_batches_remove_low_maf.bed
-rw-rw-r-- 1 dftortosa dftortosa   8689605 Dec 21 13:04 merged_batches_remove_low_maf.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_remove_low_maf.fam
-rw-rw-r-- 1 dftortosa dftortosa   2139848 Dec 21 13:04 merged_batches_remove_low_maf.hh
-rw-rw-r-- 1 dftortosa dftortosa      1622 Dec 21 13:04 merged_batches_remove_low_maf.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_remove_low_maf.nosex

Warning: 52344 het. haploid genotypes present (see
./04_remove_low_maf_snps/merged_batches_remove_low_maf.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## see the number of SNPs removed ##
The number of SNPs lost due to MAF below 0.05 is: 339759

## create freq report ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile merged_batches_remove_low_maf
  --freq

63997 MB RAM detected; reserving 31998 MB for main workspace.
299862 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.989276.
--freq: Allele frequencies (founders only) written to plink.frq .
 CHR                                             SNP   A1   A2          MAF  NCHROBS
   1                                 GSA-rs116587930    A    G      0.05781     2906
   1                                       rs3131972    T    C       0.1842     2910
   1                                      rs12127425    A    G      0.08809     2906
   1                                       rs4970383    T    G       0.2557     2882
   1                                       rs4970382    G    A       0.4069     2912
   1                                   GSA-rs4475691    T    C       0.2023     2902
   1                                       rs7537756    G    A       0.2101     2908
   1                                      rs13302982    A    G      0.06048     2910
   1                                       rs2880024    A    G       0.4242     2902

Warning: 43439 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check that no SNP has a MAF below the selected threshold ##
TRUE


###### filter by SNP missingness ######

## create missing report per SNP and sample ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile merged_batches_remove_low_maf
  --missing

63997 MB RAM detected; reserving 31998 MB for main workspace.
299862 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.989276.
--missing: Sample missing data report written to plink.imiss, and variant-based
missing data report written to plink.lmiss.
total 167744
-rw-rw-r-- 1 dftortosa dftortosa 109449633 Dec 21 13:04 merged_batches_remove_low_maf.bed
-rw-rw-r-- 1 dftortosa dftortosa   8689605 Dec 21 13:04 merged_batches_remove_low_maf.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_remove_low_maf.fam
-rw-rw-r-- 1 dftortosa dftortosa   2139848 Dec 21 13:04 merged_batches_remove_low_maf.hh
-rw-rw-r-- 1 dftortosa dftortosa      1622 Dec 21 13:04 merged_batches_remove_low_maf.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_remove_low_maf.nosex
-rw-r--r-- 1 dftortosa dftortosa  25488355 Dec 21 13:04 plink.frq
-rw-rw-r-- 1 dftortosa dftortosa   1766533 Dec 21 13:04 plink.hh
-rw-r--r-- 1 dftortosa dftortosa    105048 Dec 21 13:04 plink.imiss
-rw-r--r-- 1 dftortosa dftortosa  24041587 Dec 21 13:04 plink.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1194 Dec 21 13:04 plink.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 plink.nosex

Warning: 43439 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## See the first lines of the lmiss file ##
 CHR                                             SNP   N_MISS   N_GENO   F_MISS
   1                                 GSA-rs116587930        5     1458 0.003429
   1                                       rs3131972        3     1458 0.002058
   1                                      rs12127425        5     1458 0.003429
   1                                       rs4970383       17     1458  0.01166
   1                                       rs4970382        2     1458 0.001372
   1                                   GSA-rs4475691        7     1458 0.004801
   1                                       rs7537756        4     1458 0.002743
   1                                      rs13302982        3     1458 0.002058
   1                                       rs2880024        7     1458 0.004801


## remove SNPs with low call rate to avoid their influence when filtering samples ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./05_remove_missing_snps/merged_batches_remove_missing_snps.log.
Options in effect:
  --bfile ./04_remove_low_maf_snps/merged_batches_remove_low_maf
  --geno 0.01
  --make-bed
  --out ./05_remove_missing_snps/merged_batches_remove_missing_snps

63997 MB RAM detected; reserving 31998 MB for main workspace.
299862 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./05_remove_missing_snps/merged_batches_remove_missing_snps.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.989276.
9018 variants removed due to missing genotype data (--geno).
290844 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./05_remove_missing_snps/merged_batches_remove_missing_snps.bed +
./05_remove_missing_snps/merged_batches_remove_missing_snps.bim +
./05_remove_missing_snps/merged_batches_remove_missing_snps.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 113664
-rw-rw-r-- 1 dftortosa dftortosa 106158063 Dec 21 13:04 merged_batches_remove_missing_snps.bed
-rw-rw-r-- 1 dftortosa dftortosa   8393080 Dec 21 13:04 merged_batches_remove_missing_snps.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_remove_missing_snps.fam
-rw-rw-r-- 1 dftortosa dftortosa   1766533 Dec 21 13:04 merged_batches_remove_missing_snps.hh
-rw-rw-r-- 1 dftortosa dftortosa      1626 Dec 21 13:04 merged_batches_remove_missing_snps.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_remove_missing_snps.nosex

Warning: 43439 het. haploid genotypes present (see
./05_remove_missing_snps/merged_batches_remove_missing_snps.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## see the number of SNPs removed ##
The number of SNPs lost due to call rate below 0.99 is: 9018

## create again the missing report ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile merged_batches_remove_missing_snps
  --missing

63997 MB RAM detected; reserving 31998 MB for main workspace.
290844 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.997943.
--missing: Sample missing data report written to plink.imiss, and variant-based
missing data report written to plink.lmiss.
total 133396
-rw-rw-r-- 1 dftortosa dftortosa 106158063 Dec 21 13:04 merged_batches_remove_missing_snps.bed
-rw-rw-r-- 1 dftortosa dftortosa   8393080 Dec 21 13:04 merged_batches_remove_missing_snps.bim
-rw-rw-r-- 1 dftortosa dftortosa     56862 Dec 21 13:04 merged_batches_remove_missing_snps.fam
-rw-rw-r-- 1 dftortosa dftortosa   1766533 Dec 21 13:04 merged_batches_remove_missing_snps.hh
-rw-rw-r-- 1 dftortosa dftortosa      1626 Dec 21 13:04 merged_batches_remove_missing_snps.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_remove_missing_snps.nosex
-rw-rw-r-- 1 dftortosa dftortosa   1712032 Dec 21 13:04 plink.hh
-rw-r--r-- 1 dftortosa dftortosa    106238 Dec 21 13:04 plink.imiss
-rw-r--r-- 1 dftortosa dftortosa  18375782 Dec 21 13:04 plink.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1199 Dec 21 13:04 plink.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 plink.nosex

Warning: 42110 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check that no SNP has a missing % above the selected threshold ##
TRUE


###### Initial HWE filter ######

## create folder for this step ##
total 28
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter


## apply HWE filter ##
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./06_first_hwe_filter/merged_batches_hwe_filtered.log.
Options in effect:
  --bfile ./05_remove_missing_snps/merged_batches_remove_missing_snps
  --hwe 1e-25 keep-fewhet midp
  --make-bed
  --out ./06_first_hwe_filter/merged_batches_hwe_filtered

Start time: Sat Dec 21 13:04:12 2024
63997 MiB RAM detected, ~55794 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1458 samples (194 females, 1222 males, 42 ambiguous; 1458 founders) loaded from
./05_remove_missing_snps/merged_batches_remove_missing_snps.fam.
290844 variants loaded from
./05_remove_missing_snps/merged_batches_remove_missing_snps.bim.
Note: No phenotype data present.
Calculating allele frequencies... 0%22%45%67%90%done.
Computing chrX Hardy-Weinberg midp-values... 0%0%1%1%2%2%3%3%4%4%5%5%6%6%7%7%8%8%9%9%10%10%11%11%12%12%13%13%14%14%15%15%16%16%17%17%18%18%19%19%20%20%21%21%22%22%23%23%24%25%25%26%26%27%27%28%28%29%29%30%30%31%31%32%32%33%33%34%34%35%35%36%36%37%37%38%38%39%39%40%40%41%41%42%42%43%43%44%44%45%45%46%46%47%47%48%48%49%50%50%51%51%52%52%53%53%54%54%55%55%56%56%57%57%58%58%59%59%60%60%61%61%62%62%63%63%64%64%65%65%66%66%67%67%68%68%69%69%70%70%71%71%72%72%73%73%74%75%75%76%76%77%77%78%78%79%79%80%80%81%81%82%82%83%83%84%84%85%85%86%86%87%87%88%88%89%89%90%90%91%91%92%92%93%93%94%94%95%95%96%96%97%97%98%98%99%done.
--hwe midp keep-fewhet: 21 variants removed due to Hardy-Weinberg exact test
(founders only).
290823 variants remaining after main filters.
Writing ./06_first_hwe_filter/merged_batches_hwe_filtered.fam ... done.
Writing ./06_first_hwe_filter/merged_batches_hwe_filtered.bim ... done.
Writing ./06_first_hwe_filter/merged_batches_hwe_filtered.bed ... 0%22%45%67%90%done.
End time: Sat Dec 21 13:04:12 2024


## Less than 22 SNPs have been removed by the initial HWE filter ##
TRUE


###### remove SNPs that are considered to be pseudoautosomals but in reality are not in pseudo-autosomal regions of XY ######

## create folder for this step ##
total 32
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup


## see SNPs that are considered to be pseudoautosomals (chr=25) but in reality are not in pseudo-autosomal regions of XY ##


## check we ONLY have 21 of these problematic cases ##
TRUE


## create a list WITHOUT SNPs that are problematic for PAR: We discard SNPs that are considered to be pseudoautosomals but in reality are not in pseudo-autosomal regions of XY ##


## retain only these SNPs without the problem ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./07_par_problem_cleanup/merged_batches_hwe_par.log.
Options in effect:
  --bfile ./06_first_hwe_filter/merged_batches_hwe_filtered
  --extract ./07_par_problem_cleanup/snps_par_no_problem.txt
  --make-bed
  --out ./07_par_problem_cleanup/merged_batches_hwe_par

63997 MB RAM detected; reserving 31998 MB for main workspace.
290823 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./07_par_problem_cleanup/merged_batches_hwe_par.nosex .
--extract: 290802 variants remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.997943.
290802 variants and 1458 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./07_par_problem_cleanup/merged_batches_hwe_par.bed +
./07_par_problem_cleanup/merged_batches_hwe_par.bim +
./07_par_problem_cleanup/merged_batches_hwe_par.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 32
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup

Warning: 42110 het. haploid genotypes present (see
./07_par_problem_cleanup/merged_batches_hwe_par.hh ); many commands treat these
as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## quick check ##
TRUE


###### filter by sample missingness ######

## create folder for this step ##
total 36
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 08_remove_low_call_samples


## make sample missing report after previous filters ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./08_remove_low_call_samples/merged_batches_hwe_par_miss_report.log.
Options in effect:
  --bfile ./07_par_problem_cleanup/merged_batches_hwe_par
  --missing
  --out ./08_remove_low_call_samples/merged_batches_hwe_par_miss_report

63997 MB RAM detected; reserving 31998 MB for main workspace.
290802 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./08_remove_low_call_samples/merged_batches_hwe_par_miss_report.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1458 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.997943.
--missing: Sample missing data report written to
./08_remove_low_call_samples/merged_batches_hwe_par_miss_report.imiss, and
variant-based missing data report written to
./08_remove_low_call_samples/merged_batches_hwe_par_miss_report.lmiss.

Warning: 42110 het. haploid genotypes present (see
./08_remove_low_call_samples/merged_batches_hwe_par_miss_report.hh ); many
commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.

                   FID        IID MISS_PHENO   N_MISS   N_GENO   F_MISS
  combat_ILGSA24-17303   0200ADMM          Y       73   290802 0.000251
  combat_ILGSA24-17303   0200ASJM          Y       86   290391 0.0002962
  combat_ILGSA24-17303   0200BHNM          Y      115   290391 0.000396
  combat_ILGSA24-17303   0200CBOM          Y      374   290802 0.001286
  combat_ILGSA24-17303   0200CDFM          Y       66   290391 0.0002273
  combat_ILGSA24-17303   0200CDJM          Y       61   290391 0.0002101
  combat_ILGSA24-17303   0200JCJM          Y      923   290802 0.003174
  combat_ILGSA24-17303   0200JCMM          Y       82   290802 0.000282
  combat_ILGSA24-17303   0200JEJM          Y       76   290802 0.0002613


## check that F_MISS is just the number of missing genotype divided by the number of potentially valid calls ##
TRUE


## load the report with awk and then save it controlling the delimiter. If I load it directly into pandas, I got problems separating the columns ##
FID	IID	MISS_PHENO	N_MISS	N_GENO	F_MISS
combat_ILGSA24-17303	0200ADMM	Y	73	290802	0.000251
combat_ILGSA24-17303	0200ASJM	Y	86	290391	0.0002962
combat_ILGSA24-17303	0200BHNM	Y	115	290391	0.000396
combat_ILGSA24-17303	0200CBOM	Y	374	290802	0.001286
combat_ILGSA24-17303	0200CDFM	Y	66	290391	0.0002273
combat_ILGSA24-17303	0200CDJM	Y	61	290391	0.0002101
combat_ILGSA24-17303	0200JCJM	Y	923	290802	0.003174
combat_ILGSA24-17303	0200JCMM	Y	82	290802	0.000282
combat_ILGSA24-17303	0200JEJM	Y	76	290802	0.0002613


## load in pandas ##
                       FID       IID MISS_PHENO  N_MISS  N_GENO    F_MISS
0     combat_ILGSA24-17303  0200ADMM          Y      73  290802  0.000251
1     combat_ILGSA24-17303  0200ASJM          Y      86  290391  0.000296
2     combat_ILGSA24-17303  0200BHNM          Y     115  290391  0.000396
3     combat_ILGSA24-17303  0200CBOM          Y     374  290802  0.001286
4     combat_ILGSA24-17303  0200CDFM          Y      66  290391  0.000227
...                    ...       ...        ...     ...     ...       ...
1453  combat_ILGSA24-17873  9693JMNM          Y      55  290802  0.000189
1454  combat_ILGSA24-17873  9696DWFM          Y      64  290802  0.000220
1455  combat_ILGSA24-17873  9697STJM          Y      80  290802  0.000275
1456  combat_ILGSA24-17873  9699DNOM          Y      59  290802  0.000203
1457  combat_ILGSA24-17873  9699ISMM          Y     109  290802  0.000375

[1458 rows x 6 columns]

## check we have the correct number of samples and columns in the missing sample report ##
True
True

## calculate the proportion of samples retained at different missing thresholds ##
see the thresholds selected
[0.98, 0.981, 0.982, 0.983, 0.984, 0.985, 0.986, 0.987, 0.988, 0.989, 0.99, 0.991, 0.992, 0.993, 0.994, 0.995, 0.996, 0.997, 0.998, 0.999]
see thresholds and proportion of retained samples
    threshold  proportion_remaining
0       0.980              0.993141
1       0.981              0.993141
2       0.982              0.993141
3       0.983              0.993141
4       0.984              0.993141
5       0.985              0.993141
6       0.986              0.993141
7       0.987              0.993141
8       0.988              0.993141
9       0.989              0.993141
10      0.990              0.993141
11      0.991              0.992455
12      0.992              0.992455
13      0.993              0.992455
14      0.994              0.991770
15      0.995              0.991084
16      0.996              0.989026
17      0.997              0.986968
18      0.998              0.980110
19      0.999              0.914266

## plot sample missing thresholds against the proportion of samples retained ##

## remove samples with low call rate ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./08_remove_low_call_samples/merged_batches_hwe_par_callrate.log.
Options in effect:
  --bfile ./07_par_problem_cleanup/merged_batches_hwe_par
  --make-bed
  --mind 0.01
  --out ./08_remove_low_call_samples/merged_batches_hwe_par_callrate

63997 MB RAM detected; reserving 31998 MB for main workspace.
290802 variants loaded from .bim file.
1458 people (1222 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./08_remove_low_call_samples/merged_batches_hwe_par_callrate.nosex .
10 people removed due to missing genotype data (--mind).
IDs written to
./08_remove_low_call_samples/merged_batches_hwe_par_callrate.irem .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1448 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate in remaining samples is 0.999522.
290802 variants and 1448 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./08_remove_low_call_samples/merged_batches_hwe_par_callrate.bed
+ ./08_remove_low_call_samples/merged_batches_hwe_par_callrate.bim +
./08_remove_low_call_samples/merged_batches_hwe_par_callrate.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.

Warning: 25115 het. haploid genotypes present (see
./08_remove_low_call_samples/merged_batches_hwe_par_callrate.hh ); many
commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## see the number of samples removed ##
The number of samples lost due to call rate below 0.99 is: 10

## create again the missing report ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to merged_batches_hwe_par_callrate_missing.log.
Options in effect:
  --bfile merged_batches_hwe_par_callrate
  --missing
  --out merged_batches_hwe_par_callrate_missing

63997 MB RAM detected; reserving 31998 MB for main workspace.
290802 variants loaded from .bim file.
1448 people (1212 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to merged_batches_hwe_par_callrate_missing.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1448 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999522.
--missing: Sample missing data report written to
merged_batches_hwe_par_callrate_missing.imiss, and variant-based missing data
report written to merged_batches_hwe_par_callrate_missing.lmiss.
total 148M
-rw-rw-r-- 1 dftortosa dftortosa 101M Dec 21 13:04 merged_batches_hwe_par_callrate.bed
-rw-rw-r-- 1 dftortosa dftortosa 8.1M Dec 21 13:04 merged_batches_hwe_par_callrate.bim
-rw-rw-r-- 1 dftortosa dftortosa  56K Dec 21 13:04 merged_batches_hwe_par_callrate.fam
-rw-rw-r-- 1 dftortosa dftortosa 995K Dec 21 13:04 merged_batches_hwe_par_callrate.hh
-rw-rw-r-- 1 dftortosa dftortosa  300 Dec 21 13:04 merged_batches_hwe_par_callrate.irem
-rw-rw-r-- 1 dftortosa dftortosa 1.7K Dec 21 13:04 merged_batches_hwe_par_callrate.log
-rw-rw-r-- 1 dftortosa dftortosa 1.3K Dec 21 13:04 merged_batches_hwe_par_callrate.nosex
-rw-rw-r-- 1 dftortosa dftortosa 995K Dec 21 13:04 merged_batches_hwe_par_callrate_missing.hh
-rw-r--r-- 1 dftortosa dftortosa 104K Dec 21 13:04 merged_batches_hwe_par_callrate_missing.imiss
-rw-r--r-- 1 dftortosa dftortosa  18M Dec 21 13:04 merged_batches_hwe_par_callrate_missing.lmiss
-rw-rw-r-- 1 dftortosa dftortosa 1.4K Dec 21 13:04 merged_batches_hwe_par_callrate_missing.log
-rw-rw-r-- 1 dftortosa dftortosa 1.3K Dec 21 13:04 merged_batches_hwe_par_callrate_missing.nosex
-rw-rw-r-- 1 dftortosa dftortosa 1.7M Dec 21 13:04 merged_batches_hwe_par_miss_report.hh
-rw-r--r-- 1 dftortosa dftortosa 104K Dec 21 13:04 merged_batches_hwe_par_miss_report.imiss
-rw-r--r-- 1 dftortosa dftortosa  18M Dec 21 13:04 merged_batches_hwe_par_miss_report.lmiss
-rw-rw-r-- 1 dftortosa dftortosa 1.5K Dec 21 13:04 merged_batches_hwe_par_miss_report.log
-rw-rw-r-- 1 dftortosa dftortosa 1.3K Dec 21 13:04 merged_batches_hwe_par_miss_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa  75K Dec 21 13:04 merged_batches_hwe_par_miss_report_awk_processed.imiss
-rw-rw-r-- 1 dftortosa dftortosa  24K Dec 21 13:04 merged_batches_plot_sample_retention_thresholds.png

Warning: 25115 het. haploid genotypes present (see
merged_batches_hwe_par_callrate_missing.hh ); many commands treat these as
missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check that no sample has a missing % above the selected threshold ##
TRUE


###### remove samples with LogR SD above the illumina expectation ######

## obtain the samples above the expectation for logR dev in each batch ##

# ILGSA24-17873: process the file with the logR deviation #
CAGRF20093767_CNMetrics

## ILGSA24-17873: get the ID of samples above the illumina expectation for logR SD ##
1487CMJM
6297ANSJ
7400DZDO
7993KHJN
8502JGMJ
9601AVJM
9692NYOM
9198ACMM

['1487CMJM', '6297ANSJ', '7400DZDO', '7993KHJN', '8502JGMJ', '9601AVJM', '9692NYOM', '9198ACMM']

# ILGSA24-17303: process the file with the logR deviation #
ILGSA24-17303_CNMetrics

## ILGSA24-17303: get the ID of samples above the illumina expectation for logR SD ##
7699ZSSO
3400SMJJ
2498STAA

['7699ZSSO', '3400SMJJ', '2498STAA']

## combine the IDs from both batched into one single file ##
combat_ILGSA24-17303	7699ZSSO
combat_ILGSA24-17303	3400SMJJ
combat_ILGSA24-17303	2498STAA
combat_ILGSA24-17873	1487CMJM
combat_ILGSA24-17873	6297ANSJ
combat_ILGSA24-17873	7400DZDO
combat_ILGSA24-17873	7993KHJN
combat_ILGSA24-17873	8502JGMJ
combat_ILGSA24-17873	9601AVJM
combat_ILGSA24-17873	9692NYOM
combat_ILGSA24-17873	9198ACMM


## check we have the correct IDs in the merged file ##

# get IDs from the merged file #
7699ZSSO
3400SMJJ
2498STAA
1487CMJM
6297ANSJ
7400DZDO
7993KHJN
8502JGMJ
9601AVJM
9692NYOM
9198ACMM


# combine the list of ID samples from both batches and check it is identical than the merged list #
7699ZSSO
3400SMJJ
2498STAA

1487CMJM
6297ANSJ
7400DZDO
7993KHJN
8502JGMJ
9601AVJM
9692NYOM
9198ACMM

True

## remove these samples ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev.log.
Options in effect:
  --bfile ./08_remove_low_call_samples/merged_batches_hwe_par_callrate
  --make-bed
  --out ./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev
  --remove ../cn_metrics/merged_batches_samples_filter_out_LogRDev.tsv

63997 MB RAM detected; reserving 31998 MB for main workspace.
290802 variants loaded from .bim file.
1448 people (1212 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev.nosex
.
--remove: 1446 people remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1446 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate in remaining samples is 0.999531.
290802 variants and 1446 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev.bed +
./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev.bim +
./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev.fam
... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 112060
-rw-rw-r-- 1 dftortosa dftortosa 105270327 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev.bed
-rw-rw-r-- 1 dftortosa dftortosa   8391859 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev.fam
-rw-rw-r-- 1 dftortosa dftortosa   1018062 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev.hh
-rw-rw-r-- 1 dftortosa dftortosa      1760 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev.nosex

Warning: 25107 het. haploid genotypes present (see
./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev.hh );
many commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check that the corresponding samples are indeed not included in the new fam file ##
True

## see the number of samples removed ##
The number of samples lost due to logR SD above illumina expectations is: 2; Note that we previously filtered by missingness, so we already removed there some samples with logR dev problems

###### MAF filtering second round ######

## apply the filter ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.log.
Options in effect:
  --bfile ./09_remove_high_LogRDev_samples/merged_batches_hwe_par_callrate_LogRDev
  --maf 0.05
  --make-bed
  --out ./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf

63997 MB RAM detected; reserving 31998 MB for main workspace.
290802 variants loaded from .bim file.
1446 people (1210 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1446 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999531.
1654 variants removed due to minor allele threshold(s)
(--maf/--max-maf/--mac/--max-mac).
289148 variants and 1446 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.bed +
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.bim +
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.fam ...
0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 111428
-rw-rw-r-- 1 dftortosa dftortosa 104671579 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf.bed
-rw-rw-r-- 1 dftortosa dftortosa   8340840 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf.fam
-rw-rw-r-- 1 dftortosa dftortosa   1018062 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf.hh
-rw-rw-r-- 1 dftortosa dftortosa      1726 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf.nosex

Warning: 25107 het. haploid genotypes present (see
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.hh ); many
commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## see the number of SNPs removed ##
The number of SNPs lost due to MAF below 0.05 is: 1654

## create freq report ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to plink.log.
Options in effect:
  --bfile merged_batches_hwe_par_callrate_LogRDev_maf
  --freq

63997 MB RAM detected; reserving 31998 MB for main workspace.
289148 variants loaded from .bim file.
1446 people (1210 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to plink.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1446 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999531.
--freq: Allele frequencies (founders only) written to plink.frq .
 CHR                            SNP   A1   A2          MAF  NCHROBS
   1                GSA-rs116587930    A    G      0.05644     2888
   1                      rs3131972    T    C       0.1828     2888
   1                     rs12127425    A    G      0.08795     2888
   1                      rs4970382    G    A       0.4084     2892
   1                  GSA-rs4475691    T    C       0.2019     2892
   1                      rs7537756    G    A         0.21     2890
   1                     rs13302982    A    G      0.06051     2892
   1                      rs2880024    A    G       0.4234     2886
   1                      rs3748597    T    C       0.0536     2892

Warning: 25091 het. haploid genotypes present (see plink.hh ); many commands
treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check that no SNP has a MAF below the selected threshold ##
TRUE


###### sample relatedness ######

## create folder for this step ##
total 48
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 08_remove_low_call_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 09_remove_high_LogRDev_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 10_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 11_remove_related_samples


## calculate kinship coefficient ##

# LD-pruning #
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/ldpruned_snplist.log.
Options in effect:
  --bfile ./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf
  --indep-pairwise 500kb 1 0.2
  --out ./11_remove_related_samples/ldpruned_snplist

Start time: Sat Dec 21 13:04:14 2024
63997 MiB RAM detected, ~55798 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1446 samples (194 females, 1210 males, 42 ambiguous; 1446 founders) loaded from
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.fam.
289148 variants loaded from
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.bim.
Note: No phenotype data present.
Calculating allele frequencies... 0%22%45%67%90%done.
--indep-pairwise (26 compute threads): 0%50%190270/289148 variants removed.
Writing...
Variant lists written to ./11_remove_related_samples/ldpruned_snplist.prune.in
and ./11_remove_related_samples/ldpruned_snplist.prune.out .
End time: Sat Dec 21 13:04:14 2024
total 3164
-rw-rw-r-- 1 dftortosa dftortosa    1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa 1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa 2126515 Dec 21 13:04 ldpruned_snplist.prune.out

Do we have at least 70K SNPs after LD pruning like in Ritchie's tutorial?
see first lines of the .prune.in list:
rs3131972
rs12127425
rs13302982
rs2880024
exm2264981
rs6669800
rs6605059
rs4970414
rs28591569
rs3121578
The number of included SNPs is 98878
Is this number greater than 70K?
TRUE

PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log.
Options in effect:
  --bfile ./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf
  --extract ./11_remove_related_samples/ldpruned_snplist.prune.in
  --make-bed
  --out ./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned

63997 MB RAM detected; reserving 31998 MB for main workspace.
289148 variants loaded from .bim file.
1446 people (1210 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
.
--extract: 98878 variants remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1446 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999555.
98878 variants and 1446 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
+
./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
+
./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 41152
-rw-rw-r-- 1 dftortosa dftortosa     1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa  1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa  2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa 35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa  2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa    56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa   185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa     1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa     1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex

Warning: 4545 het. haploid genotypes present (see
./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
); many commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# remove sex chromsomes #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log.
Options in effect:
  --autosome
  --bfile ./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned
  --make-bed
  --out ./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals

63997 MB RAM detected; reserving 31998 MB for main workspace.
95241 out of 98878 variants loaded from .bim file.
1446 people (1210 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1446 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999578.
95241 variants and 1446 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed +
./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim +
./merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam ...
0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 77568
-rw-rw-r-- 1 dftortosa dftortosa     1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa  1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa  2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa 35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa  2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa    56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa   185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa     1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa     1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa 34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa  2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa    56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa     1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa     1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex

Do we have at least 70K autosomal SNPs after LD pruning like in Ritchie's tutorial?
The number of included autosomal SNPs in linkage equilibrium is 95241
Is this number greater than 70K?
TRUE

All non-autosomals SNPs have been removed from the LD pruned dataset?
TRUE


# calculate the kindship #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/ibd_report.log.
Options in effect:
  --bfile ./11_remove_related_samples/merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals
  --genome
  --out ./11_remove_related_samples/ibd_report

63997 MB RAM detected; reserving 31998 MB for main workspace.
95241 variants loaded from .bim file.
1446 people (1210 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to ./11_remove_related_samples/ibd_report.nosex .
Using up to 31 threads (change this with --threads).
Before main variant filters, 1446 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999578.
95241 variants and 1446 people pass filters and QC.
Note: No phenotypes present.

1152 markers complete.
2304 markers complete.
3456 markers complete.
4608 markers complete.
5760 markers complete.
6912 markers complete.
8064 markers complete.
9216 markers complete.
10368 markers complete.
11520 markers complete.
12672 markers complete.
13824 markers complete.
14976 markers complete.
16128 markers complete.
17280 markers complete.
18432 markers complete.
19584 markers complete.
20736 markers complete.
21888 markers complete.
23040 markers complete.
24192 markers complete.
25344 markers complete.
26496 markers complete.
27648 markers complete.
28800 markers complete.
29952 markers complete.
31104 markers complete.
32256 markers complete.
33408 markers complete.
34560 markers complete.
35712 markers complete.
36864 markers complete.
38016 markers complete.
39168 markers complete.
40320 markers complete.
41472 markers complete.
42624 markers complete.
43776 markers complete.
44928 markers complete.
46080 markers complete.
47232 markers complete.
48384 markers complete.
49536 markers complete.
50688 markers complete.
51840 markers complete.
52992 markers complete.
54144 markers complete.
55296 markers complete.
56448 markers complete.
57600 markers complete.
58752 markers complete.
59904 markers complete.
61056 markers complete.
62208 markers complete.
63360 markers complete.
64512 markers complete.
65664 markers complete.
66816 markers complete.
67968 markers complete.
69120 markers complete.
70272 markers complete.
71424 markers complete.
72576 markers complete.
73728 markers complete.
74880 markers complete.
76032 markers complete.
77184 markers complete.
78336 markers complete.
79488 markers complete.
80640 markers complete.
81792 markers complete.
82944 markers complete.
84096 markers complete.
85248 markers complete.
86400 markers complete.
87552 markers complete.
88704 markers complete.
89856 markers complete.
91008 markers complete.
92160 markers complete.
93312 markers complete.
94464 markers complete.
95241 markers complete.
IBD calculations complete.  

Writing... 1%
Writing... 2%
Writing... 3%
Writing... 4%
Writing... 5%
Writing... 6%
Writing... 7%
Writing... 8%
Writing... 9%
Writing... 10%
Writing... 11%
Writing... 12%
Writing... 13%
Writing... 14%
Writing... 15%
Writing... 16%
Writing... 17%
Writing... 18%
Writing... 19%
Writing... 20%
Writing... 21%
Writing... 22%
Writing... 23%
Writing... 24%
Writing... 25%
Writing... 26%
Writing... 27%
Writing... 28%
Writing... 29%
Writing... 30%
Writing... 31%
Writing... 32%
Writing... 33%
Writing... 34%
Writing... 35%
Writing... 36%
Writing... 37%
Writing... 38%
Writing... 39%
Writing... 40%
Writing... 41%
Writing... 42%
Writing... 43%
Writing... 44%
Writing... 45%
Writing... 46%
Writing... 47%
Writing... 48%
Writing... 49%
Writing... 50%
Writing... 51%
Writing... 52%
Writing... 53%
Writing... 54%
Writing... 55%
Writing... 56%
Writing... 57%
Writing... 58%
Writing... 59%
Writing... 60%
Writing... 61%
Writing... 62%
Writing... 63%
Writing... 64%
Writing... 65%
Writing... 66%
Writing... 67%
Writing... 68%
Writing... 69%
Writing... 70%
Writing... 71%
Writing... 72%
Writing... 73%
Writing... 74%
Writing... 75%
Writing... 76%
Writing... 77%
Writing... 78%
Writing... 79%
Writing... 80%
Writing... 81%
Writing... 82%
Writing... 83%
Writing... 84%
Writing... 85%
Writing... 86%
Writing... 87%
Writing... 88%
Writing... 89%
Writing... 90%
Writing... 91%
Writing... 92%
Writing... 93%
Writing... 94%
Writing... 95%
Writing... 96%
Writing... 97%
Writing... 98%
Writing... 99%
Finished writing ./11_remove_related_samples/ibd_report.genome .
total 216332
-rw-rw-r-- 1 dftortosa dftortosa 142084096 Dec 21 13:04 ibd_report.genome
-rw-rw-r-- 1 dftortosa dftortosa      1158 Dec 21 13:04 ibd_report.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 ibd_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa      1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa   1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa   2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa  35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa   2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa    185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa      1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa  34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa   2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex


# explore the kindship file looking for pairs with pi_hat > 0.2 #
See first lines of the IBD report
                  FID1      IID1                  FID2      IID2 RT    EZ      Z0      Z1      Z2  PI_HAT PHE       DST     PPC   RATIO
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200ASJM OT     0  0.9894  0.0000  0.0106  0.0106  -1  0.733958  0.6340  2.0236
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200BHNM OT     0  0.9776  0.0155  0.0069  0.0146  -1  0.735053  0.7441  2.0460
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200CBOM OT     0  0.9707  0.0253  0.0040  0.0167  -1  0.735272  0.1204  1.9212
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200CDFM OT     0  0.9756  0.0136  0.0108  0.0176  -1  0.735908  0.0685  1.9013
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200CDJM OT     0  0.9539  0.0461  0.0000  0.0230  -1  0.734355  0.5138  2.0024
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200JCJM OT     0  0.9749  0.0134  0.0117  0.0184  -1  0.736131  0.3741  1.9781
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200JCMM OT     0  1.0000  0.0000  0.0000  0.0000  -1  0.734411  0.0381  1.8830
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200JEJM OT     0  0.9820  0.0118  0.0062  0.0121  -1  0.734492  0.8075  2.0608
  combat_ILGSA24-17303  0200ADMM  combat_ILGSA24-17303  0200KHJM OT     0  0.9785  0.0140  0.0075  0.0145  -1  0.735076  0.6391  2.0247

 See now only those rows for which pi_hat > 0.2
  combat_ILGSA24-17303  7600TJNO  combat_ILGSA24-17303  7695SWJO OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17303  7789LMOO  combat_ILGSA24-17873  7796LMOO UN    NA  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  0197SNMM  combat_ILGSA24-17873  9187MFMM OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  0301DMMJ  combat_ILGSA24-17873  0399AMDJ OT     0  0.0000  0.0000  1.0000  1.0000  -1  0.999995  1.0000      NA
  combat_ILGSA24-17873  1499KMDM  combat_ILGSA24-17873  7201JDAS OT     0  0.4104  0.5843  0.0054  0.2975  -1  0.792120  1.0000  5.8252
  combat_ILGSA24-17873  2299MTMJ  combat_ILGSA24-17873  7496STFO OT     0  0.3204  0.4207  0.2589  0.4692  -1  0.843625  1.0000  8.3094
  combat_ILGSA24-17873  3301THMM  combat_ILGSA24-17873  8244JHMJ OT     0  0.2347  0.4979  0.2673  0.5163  -1  0.853703  1.0000 12.1045
  combat_ILGSA24-17873  3399MBAM  combat_ILGSA24-17873  9101JBJM OT     0  0.2546  0.5462  0.1992  0.4723  -1  0.840300  1.0000  9.6282
  combat_ILGSA24-17873  4596DAJA  combat_ILGSA24-17873  4598DAJA OT     0  0.0000  0.0000  1.0000  1.0000  -1  0.999995  1.0000      NA
  combat_ILGSA24-17873  6192DHJJ  combat_ILGSA24-17873  7592KHJO OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  6298TJMJ  combat_ILGSA24-17873  6797WFAS OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  6697EVFA  combat_ILGSA24-17873  7493BVNO OT     0  0.2527  0.5062  0.2411  0.4942  -1  0.847508  1.0000 10.6254
  combat_ILGSA24-17873  6697MMNA  combat_ILGSA24-17873  8697DMNJ OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  7196AMSS  combat_ILGSA24-17873  9196GCNM OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  7974SJNN  combat_ILGSA24-17873  8145ORJJ OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  8002DPAN  combat_ILGSA24-17873  8097JCJN OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  8244CDSJ  combat_ILGSA24-17873  8244DCDJ OT     0  0.0000  0.0000  1.0000  1.0000  -1  0.999995  1.0000      NA
  combat_ILGSA24-17873  8500AEAJ  combat_ILGSA24-17873  8699WPAJ OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  8500NHNJ  combat_ILGSA24-17873  8501CGDJ OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA
  combat_ILGSA24-17873  9196RFJM  combat_ILGSA24-17873  9199ACMM OT     0  0.0000  0.0000  1.0000  1.0000  -1  1.000000  1.0000      NA


# convert delimiter of ibd report #
total 237100
-rw-rw-r-- 1 dftortosa dftortosa 142084096 Dec 21 13:04 ibd_report.genome
-rw-rw-r-- 1 dftortosa dftortosa      1158 Dec 21 13:04 ibd_report.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 ibd_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa  21264041 Dec 21 13:04 ibd_report_awk_processed.genome.tsv.gz
-rw-rw-r-- 1 dftortosa dftortosa      1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa   1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa   2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa  35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa   2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa    185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa      1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa  34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa   2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex


# load ibd report as pandas DF #
                         FID1      IID1  ...     PPC   RATIO
0        combat_ILGSA24-17303  0200ADMM  ...  0.6340  2.0236
1        combat_ILGSA24-17303  0200ADMM  ...  0.7441  2.0460
2        combat_ILGSA24-17303  0200ADMM  ...  0.1204  1.9212
3        combat_ILGSA24-17303  0200ADMM  ...  0.0685  1.9013
4        combat_ILGSA24-17303  0200ADMM  ...  0.5138  2.0024
...                       ...       ...  ...     ...     ...
1044730  combat_ILGSA24-17873  9696DWFM  ...  0.6683  2.0302
1044731  combat_ILGSA24-17873  9696DWFM  ...  0.5635  2.0110
1044732  combat_ILGSA24-17873  9697STJM  ...  0.7170  2.0401
1044733  combat_ILGSA24-17873  9697STJM  ...  0.8132  2.0622
1044734  combat_ILGSA24-17873  9699DNOM  ...  0.1417  1.9283

[1044735 rows x 14 columns]

# plot Z0 vs Z1 and Z2 #
check that the cases with Z0 and Z1 equal to 0 are those with Z2=1
TRUE

# plot histogram of pi_hat #

# We have multiple cases with PI_HAT around 0.2, 0.5 and 1, which are potential second, first-degree relatives and twins/duplicated samples, respectively #
                         FID1      IID1                  FID2      IID2  PI_HAT
210766   combat_ILGSA24-17303  7600TJNO  combat_ILGSA24-17303  7695SWJO  1.0000
266315   combat_ILGSA24-17303  7789LMOO  combat_ILGSA24-17873  7796LMOO  1.0000
310823   combat_ILGSA24-17873  0197SNMM  combat_ILGSA24-17873  9187MFMM  1.0000
342051   combat_ILGSA24-17873  0301DMMJ  combat_ILGSA24-17873  0399AMDJ  1.0000
478788   combat_ILGSA24-17873  1499KMDM  combat_ILGSA24-17873  7201JDAS  0.2975
541880   combat_ILGSA24-17873  2299MTMJ  combat_ILGSA24-17873  7496STFO  0.4692
606984   combat_ILGSA24-17873  3301THMM  combat_ILGSA24-17873  8244JHMJ  0.5163
621026   combat_ILGSA24-17873  3399MBAM  combat_ILGSA24-17873  9101JBJM  0.4723
760106   combat_ILGSA24-17873  4596DAJA  combat_ILGSA24-17873  4598DAJA  1.0000
818277   combat_ILGSA24-17873  6192DHJJ  combat_ILGSA24-17873  7592KHJO  1.0000
830675   combat_ILGSA24-17873  6298TJMJ  combat_ILGSA24-17873  6797WFAS  1.0000
893403   combat_ILGSA24-17873  6697EVFA  combat_ILGSA24-17873  7493BVNO  0.4942
894224   combat_ILGSA24-17873  6697MMNA  combat_ILGSA24-17873  8697DMNJ  1.0000
945904   combat_ILGSA24-17873  7196AMSS  combat_ILGSA24-17873  9196GCNM  1.0000
1012418  combat_ILGSA24-17873  7974SJNN  combat_ILGSA24-17873  8145ORJJ  1.0000
1018867  combat_ILGSA24-17873  8002DPAN  combat_ILGSA24-17873  8097JCJN  1.0000
1028445  combat_ILGSA24-17873  8244CDSJ  combat_ILGSA24-17873  8244DCDJ  1.0000
1031773  combat_ILGSA24-17873  8500AEAJ  combat_ILGSA24-17873  8699WPAJ  1.0000
1032648  combat_ILGSA24-17873  8500NHNJ  combat_ILGSA24-17873  8501CGDJ  1.0000
1043957  combat_ILGSA24-17873  9196RFJM  combat_ILGSA24-17873  9199ACMM  1.0000

# print unique related samples with pi_hat > 0.2 #
We have 40 samples with PI_HAT > 0.2
['7600TJNO' '7789LMOO' '0197SNMM' '0301DMMJ' '1499KMDM' '2299MTMJ'
 '3301THMM' '3399MBAM' '4596DAJA' '6192DHJJ' '6298TJMJ' '6697EVFA'
 '6697MMNA' '7196AMSS' '7974SJNN' '8002DPAN' '8244CDSJ' '8500AEAJ'
 '8500NHNJ' '9196RFJM' '7695SWJO' '7796LMOO' '9187MFMM' '0399AMDJ'
 '7201JDAS' '7496STFO' '8244JHMJ' '9101JBJM' '4598DAJA' '7592KHJO'
 '6797WFAS' '7493BVNO' '8697DMNJ' '9196GCNM' '8145ORJJ' '8097JCJN'
 '8244DCDJ' '8699WPAJ' '8501CGDJ' '9199ACMM']

## run KING-robust with plink2 ##

# make subfolder for KING #
total 237136
-rw-rw-r-- 1 dftortosa dftortosa 142084096 Dec 21 13:04 ibd_report.genome
-rw-rw-r-- 1 dftortosa dftortosa      1158 Dec 21 13:04 ibd_report.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 ibd_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa  21264041 Dec 21 13:04 ibd_report_awk_processed.genome.tsv.gz
drwxrwxr-x 2 dftortosa dftortosa      4096 Dec 21 13:04 king_analyses
-rw-rw-r-- 1 dftortosa dftortosa      1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa   1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa   2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa  35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa   2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa    185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa      1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa  34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa   2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex
-rw-rw-r-- 1 dftortosa dftortosa     16404 Dec 21 13:04 pairs_relatdness_before_filtering.png
-rw-rw-r-- 1 dftortosa dftortosa     10391 Dec 21 13:04 pi_hat_hist.png


# intro to KING #
The geometric mean of king-cutoffs for second and third-degree relatives (0.125 and 0.0625, respectively) is 0.08838834764831845. This could be used to filter second-degree relatives

# run --make-king-table to get a table with kindship coefficients #
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/king_analyses/king_table.log.
Options in effect:
  --bfile ./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf
  --king-table-filter 0.088
  --make-king-table
  --out ./11_remove_related_samples/king_analyses/king_table

Start time: Sat Dec 21 13:04:29 2024
63997 MiB RAM detected, ~55566 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1446 samples (194 females, 1210 males, 42 ambiguous; 1446 founders) loaded from
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.fam.
289148 variants loaded from
./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf.bim.
Note: No phenotype data present.
Excluding 17847 variants on non-autosomes from KING-robust calculation.
--make-king-table pass 1/1: Scanning for rare variants... 0%24%48%72%96%done.
0 variants handled by initial scan (271301 remaining).

--make-king-table pass 1/1: 0 variants complete.
--make-king-table pass 1/1: 1536 variants complete.
--make-king-table pass 1/1: 3072 variants complete.
--make-king-table pass 1/1: 4608 variants complete.
--make-king-table pass 1/1: 6144 variants complete.
--make-king-table pass 1/1: 7680 variants complete.
--make-king-table pass 1/1: 9216 variants complete.
--make-king-table pass 1/1: 10752 variants complete.
--make-king-table pass 1/1: 12288 variants complete.
--make-king-table pass 1/1: 13824 variants complete.
--make-king-table pass 1/1: 15360 variants complete.
--make-king-table pass 1/1: 16896 variants complete.
--make-king-table pass 1/1: 18432 variants complete.
--make-king-table pass 1/1: 19968 variants complete.
--make-king-table pass 1/1: 21504 variants complete.
--make-king-table pass 1/1: 23040 variants complete.
--make-king-table pass 1/1: 24576 variants complete.
--make-king-table pass 1/1: 26112 variants complete.
--make-king-table pass 1/1: 27648 variants complete.
--make-king-table pass 1/1: 29184 variants complete.
--make-king-table pass 1/1: 30720 variants complete.
--make-king-table pass 1/1: 32256 variants complete.
--make-king-table pass 1/1: 33792 variants complete.
--make-king-table pass 1/1: 35328 variants complete.
--make-king-table pass 1/1: 36864 variants complete.
--make-king-table pass 1/1: 38400 variants complete.
--make-king-table pass 1/1: 39936 variants complete.
--make-king-table pass 1/1: 41472 variants complete.
--make-king-table pass 1/1: 43008 variants complete.
--make-king-table pass 1/1: 44544 variants complete.
--make-king-table pass 1/1: 46080 variants complete.
--make-king-table pass 1/1: 47616 variants complete.
--make-king-table pass 1/1: 49152 variants complete.
--make-king-table pass 1/1: 50688 variants complete.
--make-king-table pass 1/1: 52224 variants complete.
--make-king-table pass 1/1: 53760 variants complete.
--make-king-table pass 1/1: 55296 variants complete.
--make-king-table pass 1/1: 56832 variants complete.
--make-king-table pass 1/1: 58368 variants complete.
--make-king-table pass 1/1: 59904 variants complete.
--make-king-table pass 1/1: 61440 variants complete.
--make-king-table pass 1/1: 62976 variants complete.
--make-king-table pass 1/1: 64512 variants complete.
--make-king-table pass 1/1: 66048 variants complete.
--make-king-table pass 1/1: 67584 variants complete.
--make-king-table pass 1/1: 69120 variants complete.
--make-king-table pass 1/1: 70656 variants complete.
--make-king-table pass 1/1: 72192 variants complete.
--make-king-table pass 1/1: 73728 variants complete.
--make-king-table pass 1/1: 75264 variants complete.
--make-king-table pass 1/1: 76800 variants complete.
--make-king-table pass 1/1: 78336 variants complete.
--make-king-table pass 1/1: 79872 variants complete.
--make-king-table pass 1/1: 81408 variants complete.
--make-king-table pass 1/1: 82944 variants complete.
--make-king-table pass 1/1: 84480 variants complete.
--make-king-table pass 1/1: 86016 variants complete.
--make-king-table pass 1/1: 87552 variants complete.
--make-king-table pass 1/1: 89088 variants complete.
--make-king-table pass 1/1: 90624 variants complete.
--make-king-table pass 1/1: 92160 variants complete.
--make-king-table pass 1/1: 93696 variants complete.
--make-king-table pass 1/1: 95232 variants complete.
--make-king-table pass 1/1: 96768 variants complete.
--make-king-table pass 1/1: 98304 variants complete.
--make-king-table pass 1/1: 99840 variants complete.
--make-king-table pass 1/1: 101376 variants complete.
--make-king-table pass 1/1: 102912 variants complete.
--make-king-table pass 1/1: 104448 variants complete.
--make-king-table pass 1/1: 105984 variants complete.
--make-king-table pass 1/1: 107520 variants complete.
--make-king-table pass 1/1: 109056 variants complete.
--make-king-table pass 1/1: 110592 variants complete.
--make-king-table pass 1/1: 112128 variants complete.
--make-king-table pass 1/1: 113664 variants complete.
--make-king-table pass 1/1: 115200 variants complete.
--make-king-table pass 1/1: 116736 variants complete.
--make-king-table pass 1/1: 118272 variants complete.
--make-king-table pass 1/1: 119808 variants complete.
--make-king-table pass 1/1: 121344 variants complete.
--make-king-table pass 1/1: 122880 variants complete.
--make-king-table pass 1/1: 124416 variants complete.
--make-king-table pass 1/1: 125952 variants complete.
--make-king-table pass 1/1: 127488 variants complete.
--make-king-table pass 1/1: 129024 variants complete.
--make-king-table pass 1/1: 130560 variants complete.
--make-king-table pass 1/1: 132096 variants complete.
--make-king-table pass 1/1: 133632 variants complete.
--make-king-table pass 1/1: 135168 variants complete.
--make-king-table pass 1/1: 136704 variants complete.
--make-king-table pass 1/1: 138240 variants complete.
--make-king-table pass 1/1: 139776 variants complete.
--make-king-table pass 1/1: 141312 variants complete.
--make-king-table pass 1/1: 142848 variants complete.
--make-king-table pass 1/1: 144384 variants complete.
--make-king-table pass 1/1: 145920 variants complete.
--make-king-table pass 1/1: 147456 variants complete.
--make-king-table pass 1/1: 148992 variants complete.
--make-king-table pass 1/1: 150528 variants complete.
--make-king-table pass 1/1: 152064 variants complete.
--make-king-table pass 1/1: 153600 variants complete.
--make-king-table pass 1/1: 155136 variants complete.
--make-king-table pass 1/1: 156672 variants complete.
--make-king-table pass 1/1: 158208 variants complete.
--make-king-table pass 1/1: 159744 variants complete.
--make-king-table pass 1/1: 161280 variants complete.
--make-king-table pass 1/1: 162816 variants complete.
--make-king-table pass 1/1: 164352 variants complete.
--make-king-table pass 1/1: 165888 variants complete.
--make-king-table pass 1/1: 167424 variants complete.
--make-king-table pass 1/1: 168960 variants complete.
--make-king-table pass 1/1: 170496 variants complete.
--make-king-table pass 1/1: 172032 variants complete.
--make-king-table pass 1/1: 173568 variants complete.
--make-king-table pass 1/1: 175104 variants complete.
--make-king-table pass 1/1: 176640 variants complete.
--make-king-table pass 1/1: 178176 variants complete.
--make-king-table pass 1/1: 179712 variants complete.
--make-king-table pass 1/1: 181248 variants complete.
--make-king-table pass 1/1: 182784 variants complete.
--make-king-table pass 1/1: 184320 variants complete.
--make-king-table pass 1/1: 185856 variants complete.
--make-king-table pass 1/1: 187392 variants complete.
--make-king-table pass 1/1: 188928 variants complete.
--make-king-table pass 1/1: 190464 variants complete.
--make-king-table pass 1/1: 192000 variants complete.
--make-king-table pass 1/1: 193536 variants complete.
--make-king-table pass 1/1: 195072 variants complete.
--make-king-table pass 1/1: 196608 variants complete.
--make-king-table pass 1/1: 198144 variants complete.
--make-king-table pass 1/1: 199680 variants complete.
--make-king-table pass 1/1: 201216 variants complete.
--make-king-table pass 1/1: 202752 variants complete.
--make-king-table pass 1/1: 204288 variants complete.
--make-king-table pass 1/1: 205824 variants complete.
--make-king-table pass 1/1: 207360 variants complete.
--make-king-table pass 1/1: 208896 variants complete.
--make-king-table pass 1/1: 210432 variants complete.
--make-king-table pass 1/1: 211968 variants complete.
--make-king-table pass 1/1: 213504 variants complete.
--make-king-table pass 1/1: 215040 variants complete.
--make-king-table pass 1/1: 216576 variants complete.
--make-king-table pass 1/1: 218112 variants complete.
--make-king-table pass 1/1: 219648 variants complete.
--make-king-table pass 1/1: 221184 variants complete.
--make-king-table pass 1/1: 222720 variants complete.
--make-king-table pass 1/1: 224256 variants complete.
--make-king-table pass 1/1: 225792 variants complete.
--make-king-table pass 1/1: 227328 variants complete.
--make-king-table pass 1/1: 228864 variants complete.
--make-king-table pass 1/1: 230400 variants complete.
--make-king-table pass 1/1: 231936 variants complete.
--make-king-table pass 1/1: 233472 variants complete.
--make-king-table pass 1/1: 235008 variants complete.
--make-king-table pass 1/1: 236544 variants complete.
--make-king-table pass 1/1: 238080 variants complete.
--make-king-table pass 1/1: 239616 variants complete.
--make-king-table pass 1/1: 241152 variants complete.
--make-king-table pass 1/1: 242688 variants complete.
--make-king-table pass 1/1: 244224 variants complete.
--make-king-table pass 1/1: 245760 variants complete.
--make-king-table pass 1/1: 247296 variants complete.
--make-king-table pass 1/1: 248832 variants complete.
--make-king-table pass 1/1: 250368 variants complete.
--make-king-table pass 1/1: 251904 variants complete.
--make-king-table pass 1/1: 253440 variants complete.
--make-king-table pass 1/1: 254976 variants complete.
--make-king-table pass 1/1: 256512 variants complete.
--make-king-table pass 1/1: 258048 variants complete.
--make-king-table pass 1/1: 259584 variants complete.
--make-king-table pass 1/1: 261120 variants complete.
--make-king-table pass 1/1: 262656 variants complete.
--make-king-table pass 1/1: 264192 variants complete.
--make-king-table pass 1/1: 265728 variants complete.
--make-king-table pass 1/1: 267264 variants complete.
--make-king-table pass 1/1: 268800 variants complete.
--make-king-table pass 1/1: 270336 variants complete.
--make-king-table pass 1/1: Writing...                    done.
--make-king-table: 271301 variants processed.
Results written to ./11_remove_related_samples/king_analyses/king_table.kin0 .
--king-table-filter: 20 relationships reported (1044715 filtered out).
End time: Sat Dec 21 13:04:30 2024
total 237136
-rw-rw-r-- 1 dftortosa dftortosa 142084096 Dec 21 13:04 ibd_report.genome
-rw-rw-r-- 1 dftortosa dftortosa      1158 Dec 21 13:04 ibd_report.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 ibd_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa  21264041 Dec 21 13:04 ibd_report_awk_processed.genome.tsv.gz
drwxrwxr-x 2 dftortosa dftortosa      4096 Dec 21 13:04 king_analyses
-rw-rw-r-- 1 dftortosa dftortosa      1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa   1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa   2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa  35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa   2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa    185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa      1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa  34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa   2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex
-rw-rw-r-- 1 dftortosa dftortosa     16404 Dec 21 13:04 pairs_relatdness_before_filtering.png
-rw-rw-r-- 1 dftortosa dftortosa     10391 Dec 21 13:04 pi_hat_hist.png


###### load the talbe in python ######
                   #FID1      IID1  ...      IBS0   KINSHIP
0   combat_ILGSA24-17303  7695SWJO  ...  0.000000  0.500000
1   combat_ILGSA24-17873  0399AMDJ  ...  0.000000  0.499997
2   combat_ILGSA24-17873  4598DAJA  ...  0.000000  0.499997
3   combat_ILGSA24-17873  6797WFAS  ...  0.000000  0.500000
4   combat_ILGSA24-17873  7201JDAS  ...  0.026301  0.146409
5   combat_ILGSA24-17873  7493BVNO  ...  0.016356  0.243733
6   combat_ILGSA24-17873  7496STFO  ...  0.020045  0.231122
7   combat_ILGSA24-17873  7592KHJO  ...  0.000000  0.500000
8   combat_ILGSA24-17873  7796LMOO  ...  0.000000  0.500000
9   combat_ILGSA24-17873  8097JCJN  ...  0.000000  0.499997
10  combat_ILGSA24-17873  8145ORJJ  ...  0.000000  0.500000
11  combat_ILGSA24-17873  8244DCDJ  ...  0.000000  0.499992
12  combat_ILGSA24-17873  8244JHMJ  ...  0.014719  0.258806
13  combat_ILGSA24-17873  8501CGDJ  ...  0.000000  0.500000
14  combat_ILGSA24-17873  8697DMNJ  ...  0.000000  0.500000
15  combat_ILGSA24-17873  8699WPAJ  ...  0.000000  0.499997
16  combat_ILGSA24-17873  9101JBJM  ...  0.016883  0.230080
17  combat_ILGSA24-17873  9187MFMM  ...  0.000000  0.500000
18  combat_ILGSA24-17873  9196GCNM  ...  0.000000  0.500000
19  combat_ILGSA24-17873  9199ACMM  ...  0.000000  0.500000

[20 rows x 8 columns]
extract the unique cases 
We have 40 samples with KING-robust between-family kinship estimate > 0.088
['7695SWJO' '0399AMDJ' '4598DAJA' '6797WFAS' '7201JDAS' '7493BVNO'
 '7496STFO' '7592KHJO' '7796LMOO' '8097JCJN' '8145ORJJ' '8244DCDJ'
 '8244JHMJ' '8501CGDJ' '8697DMNJ' '8699WPAJ' '9101JBJM' '9187MFMM'
 '9196GCNM' '9199ACMM' '7600TJNO' '0301DMMJ' '4596DAJA' '6298TJMJ'
 '1499KMDM' '6697EVFA' '2299MTMJ' '6192DHJJ' '7789LMOO' '8002DPAN'
 '7974SJNN' '8244CDSJ' '3301THMM' '8500NHNJ' '6697MMNA' '8500AEAJ'
 '3399MBAM' '0197SNMM' '7196AMSS' '9196RFJM']

# do we have the same problematic samples in king (kindship>0.088) and pi_hat (pi_Hat>0.2)? #
check we have the exact same problematic IDs
True
Count number of each case with both approaches
Duplicates: PI_HAT=0.5 (15) and KINSHIP>0.354 (15)
First-degree: PI_HAT around 0.5 (4) and KINDSHIP between 0.17 and 0.35 (4)
Second-degree: PI_HAT around 0.25 (1) and KINDSHIP between 0.08 and 0.17 (1)
check that NONE of the problematic cases have all NA for phenotypes, this would be a problem] because we would need to prioritize cases with pheno instead of using the greedy approach implement in PLINK 2

     Gender        Age  ...  Week 8 Pred VO2max  AGRF code
0         M  25.000000  ...                47.7   8244TCOJ
1         M  43.720548  ...                43.6   6976MCJS
2         M  35.049315  ...                49.0   3484JSJJ
3         F  23.561644  ...                43.6   1389HSNM
4         M  26.164384  ...                54.0   7593DBAO
...     ...        ...  ...                 ...        ...
1459    NaN        NaN  ...                 NaN   2471AWMA
1460    NaN        NaN  ...                 NaN   6897TSSS
1461    NaN        NaN  ...                 NaN   6899DWOS
1462    NaN        NaN  ...                 NaN   6296TONJ
1463    NaN        NaN  ...                 NaN   7799BTDO

[1464 rows x 11 columns]

True
True
True

# Remove samples with a kindship above 0.354 #
from the king table, select samples above the monozygotic twins threshold
remove duplicated samples from plink files
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.log.
Options in effect:
  --bfile ./10_remove_low_maf_snps/merged_batches_hwe_par_callrate_LogRDev_maf
  --make-bed
  --out ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates
  --remove ./11_remove_related_samples/king_analyses/id_samples_duplicates.txt

63997 MB RAM detected; reserving 31998 MB for main workspace.
289148 variants loaded from .bim file.
1446 people (1210 males, 194 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.nosex
.
--remove: 1416 people remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1416 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate in remaining samples is 0.999531.
289148 variants and 1416 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.bed
+
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.bim
+
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.fam
... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.

Warning: 19361 het. haploid genotypes present (see
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.hh
); many commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.

load the resulting FAM file and check we do not have the duplicated samples
True
make a new king table to see the result consdering third-degree relatives and above
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/king_analyses/king_table_after_dups.log.
Options in effect:
  --bfile ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates
  --king-table-filter 0.088
  --make-king-table
  --out ./11_remove_related_samples/king_analyses/king_table_after_dups

Start time: Sat Dec 21 13:04:31 2024
63997 MiB RAM detected, ~55567 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1416 samples (190 females, 1184 males, 42 ambiguous; 1416 founders) loaded from
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.fam.
289148 variants loaded from
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.bim.
Note: No phenotype data present.
Excluding 17847 variants on non-autosomes from KING-robust calculation.
--make-king-table pass 1/1: Scanning for rare variants... 0%24%48%72%96%done.
0 variants handled by initial scan (271301 remaining).

--make-king-table pass 1/1: 0 variants complete.
--make-king-table pass 1/1: 1536 variants complete.
--make-king-table pass 1/1: 3072 variants complete.
--make-king-table pass 1/1: 4608 variants complete.
--make-king-table pass 1/1: 6144 variants complete.
--make-king-table pass 1/1: 7680 variants complete.
--make-king-table pass 1/1: 9216 variants complete.
--make-king-table pass 1/1: 10752 variants complete.
--make-king-table pass 1/1: 12288 variants complete.
--make-king-table pass 1/1: 13824 variants complete.
--make-king-table pass 1/1: 15360 variants complete.
--make-king-table pass 1/1: 16896 variants complete.
--make-king-table pass 1/1: 18432 variants complete.
--make-king-table pass 1/1: 19968 variants complete.
--make-king-table pass 1/1: 21504 variants complete.
--make-king-table pass 1/1: 23040 variants complete.
--make-king-table pass 1/1: 24576 variants complete.
--make-king-table pass 1/1: 26112 variants complete.
--make-king-table pass 1/1: 27648 variants complete.
--make-king-table pass 1/1: 29184 variants complete.
--make-king-table pass 1/1: 30720 variants complete.
--make-king-table pass 1/1: 32256 variants complete.
--make-king-table pass 1/1: 33792 variants complete.
--make-king-table pass 1/1: 35328 variants complete.
--make-king-table pass 1/1: 36864 variants complete.
--make-king-table pass 1/1: 38400 variants complete.
--make-king-table pass 1/1: 39936 variants complete.
--make-king-table pass 1/1: 41472 variants complete.
--make-king-table pass 1/1: 43008 variants complete.
--make-king-table pass 1/1: 44544 variants complete.
--make-king-table pass 1/1: 46080 variants complete.
--make-king-table pass 1/1: 47616 variants complete.
--make-king-table pass 1/1: 49152 variants complete.
--make-king-table pass 1/1: 50688 variants complete.
--make-king-table pass 1/1: 52224 variants complete.
--make-king-table pass 1/1: 53760 variants complete.
--make-king-table pass 1/1: 55296 variants complete.
--make-king-table pass 1/1: 56832 variants complete.
--make-king-table pass 1/1: 58368 variants complete.
--make-king-table pass 1/1: 59904 variants complete.
--make-king-table pass 1/1: 61440 variants complete.
--make-king-table pass 1/1: 62976 variants complete.
--make-king-table pass 1/1: 64512 variants complete.
--make-king-table pass 1/1: 66048 variants complete.
--make-king-table pass 1/1: 67584 variants complete.
--make-king-table pass 1/1: 69120 variants complete.
--make-king-table pass 1/1: 70656 variants complete.
--make-king-table pass 1/1: 72192 variants complete.
--make-king-table pass 1/1: 73728 variants complete.
--make-king-table pass 1/1: 75264 variants complete.
--make-king-table pass 1/1: 76800 variants complete.
--make-king-table pass 1/1: 78336 variants complete.
--make-king-table pass 1/1: 79872 variants complete.
--make-king-table pass 1/1: 81408 variants complete.
--make-king-table pass 1/1: 82944 variants complete.
--make-king-table pass 1/1: 84480 variants complete.
--make-king-table pass 1/1: 86016 variants complete.
--make-king-table pass 1/1: 87552 variants complete.
--make-king-table pass 1/1: 89088 variants complete.
--make-king-table pass 1/1: 90624 variants complete.
--make-king-table pass 1/1: 92160 variants complete.
--make-king-table pass 1/1: 93696 variants complete.
--make-king-table pass 1/1: 95232 variants complete.
--make-king-table pass 1/1: 96768 variants complete.
--make-king-table pass 1/1: 98304 variants complete.
--make-king-table pass 1/1: 99840 variants complete.
--make-king-table pass 1/1: 101376 variants complete.
--make-king-table pass 1/1: 102912 variants complete.
--make-king-table pass 1/1: 104448 variants complete.
--make-king-table pass 1/1: 105984 variants complete.
--make-king-table pass 1/1: 107520 variants complete.
--make-king-table pass 1/1: 109056 variants complete.
--make-king-table pass 1/1: 110592 variants complete.
--make-king-table pass 1/1: 112128 variants complete.
--make-king-table pass 1/1: 113664 variants complete.
--make-king-table pass 1/1: 115200 variants complete.
--make-king-table pass 1/1: 116736 variants complete.
--make-king-table pass 1/1: 118272 variants complete.
--make-king-table pass 1/1: 119808 variants complete.
--make-king-table pass 1/1: 121344 variants complete.
--make-king-table pass 1/1: 122880 variants complete.
--make-king-table pass 1/1: 124416 variants complete.
--make-king-table pass 1/1: 125952 variants complete.
--make-king-table pass 1/1: 127488 variants complete.
--make-king-table pass 1/1: 129024 variants complete.
--make-king-table pass 1/1: 130560 variants complete.
--make-king-table pass 1/1: 132096 variants complete.
--make-king-table pass 1/1: 133632 variants complete.
--make-king-table pass 1/1: 135168 variants complete.
--make-king-table pass 1/1: 136704 variants complete.
--make-king-table pass 1/1: 138240 variants complete.
--make-king-table pass 1/1: 139776 variants complete.
--make-king-table pass 1/1: 141312 variants complete.
--make-king-table pass 1/1: 142848 variants complete.
--make-king-table pass 1/1: 144384 variants complete.
--make-king-table pass 1/1: 145920 variants complete.
--make-king-table pass 1/1: 147456 variants complete.
--make-king-table pass 1/1: 148992 variants complete.
--make-king-table pass 1/1: 150528 variants complete.
--make-king-table pass 1/1: 152064 variants complete.
--make-king-table pass 1/1: 153600 variants complete.
--make-king-table pass 1/1: 155136 variants complete.
--make-king-table pass 1/1: 156672 variants complete.
--make-king-table pass 1/1: 158208 variants complete.
--make-king-table pass 1/1: 159744 variants complete.
--make-king-table pass 1/1: 161280 variants complete.
--make-king-table pass 1/1: 162816 variants complete.
--make-king-table pass 1/1: 164352 variants complete.
--make-king-table pass 1/1: 165888 variants complete.
--make-king-table pass 1/1: 167424 variants complete.
--make-king-table pass 1/1: 168960 variants complete.
--make-king-table pass 1/1: 170496 variants complete.
--make-king-table pass 1/1: 172032 variants complete.
--make-king-table pass 1/1: 173568 variants complete.
--make-king-table pass 1/1: 175104 variants complete.
--make-king-table pass 1/1: 176640 variants complete.
--make-king-table pass 1/1: 178176 variants complete.
--make-king-table pass 1/1: 179712 variants complete.
--make-king-table pass 1/1: 181248 variants complete.
--make-king-table pass 1/1: 182784 variants complete.
--make-king-table pass 1/1: 184320 variants complete.
--make-king-table pass 1/1: 185856 variants complete.
--make-king-table pass 1/1: 187392 variants complete.
--make-king-table pass 1/1: 188928 variants complete.
--make-king-table pass 1/1: 190464 variants complete.
--make-king-table pass 1/1: 192000 variants complete.
--make-king-table pass 1/1: 193536 variants complete.
--make-king-table pass 1/1: 195072 variants complete.
--make-king-table pass 1/1: 196608 variants complete.
--make-king-table pass 1/1: 198144 variants complete.
--make-king-table pass 1/1: 199680 variants complete.
--make-king-table pass 1/1: 201216 variants complete.
--make-king-table pass 1/1: 202752 variants complete.
--make-king-table pass 1/1: 204288 variants complete.
--make-king-table pass 1/1: 205824 variants complete.
--make-king-table pass 1/1: 207360 variants complete.
--make-king-table pass 1/1: 208896 variants complete.
--make-king-table pass 1/1: 210432 variants complete.
--make-king-table pass 1/1: 211968 variants complete.
--make-king-table pass 1/1: 213504 variants complete.
--make-king-table pass 1/1: 215040 variants complete.
--make-king-table pass 1/1: 216576 variants complete.
--make-king-table pass 1/1: 218112 variants complete.
--make-king-table pass 1/1: 219648 variants complete.
--make-king-table pass 1/1: 221184 variants complete.
--make-king-table pass 1/1: 222720 variants complete.
--make-king-table pass 1/1: 224256 variants complete.
--make-king-table pass 1/1: 225792 variants complete.
--make-king-table pass 1/1: 227328 variants complete.
--make-king-table pass 1/1: 228864 variants complete.
--make-king-table pass 1/1: 230400 variants complete.
--make-king-table pass 1/1: 231936 variants complete.
--make-king-table pass 1/1: 233472 variants complete.
--make-king-table pass 1/1: 235008 variants complete.
--make-king-table pass 1/1: 236544 variants complete.
--make-king-table pass 1/1: 238080 variants complete.
--make-king-table pass 1/1: 239616 variants complete.
--make-king-table pass 1/1: 241152 variants complete.
--make-king-table pass 1/1: 242688 variants complete.
--make-king-table pass 1/1: 244224 variants complete.
--make-king-table pass 1/1: 245760 variants complete.
--make-king-table pass 1/1: 247296 variants complete.
--make-king-table pass 1/1: 248832 variants complete.
--make-king-table pass 1/1: 250368 variants complete.
--make-king-table pass 1/1: 251904 variants complete.
--make-king-table pass 1/1: 253440 variants complete.
--make-king-table pass 1/1: 254976 variants complete.
--make-king-table pass 1/1: 256512 variants complete.
--make-king-table pass 1/1: 258048 variants complete.
--make-king-table pass 1/1: 259584 variants complete.
--make-king-table pass 1/1: 261120 variants complete.
--make-king-table pass 1/1: 262656 variants complete.
--make-king-table pass 1/1: 264192 variants complete.
--make-king-table pass 1/1: 265728 variants complete.
--make-king-table pass 1/1: 267264 variants complete.
--make-king-table pass 1/1: 268800 variants complete.
--make-king-table pass 1/1: 270336 variants complete.
--make-king-table pass 1/1: Writing...                    done.
--make-king-table: 271301 variants processed.
Results written to
./11_remove_related_samples/king_analyses/king_table_after_dups.kin0 .
--king-table-filter: 5 relationships reported (1001815 filtered out).
End time: Sat Dec 21 13:04:32 2024
total 237136
-rw-rw-r-- 1 dftortosa dftortosa 142084096 Dec 21 13:04 ibd_report.genome
-rw-rw-r-- 1 dftortosa dftortosa      1158 Dec 21 13:04 ibd_report.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 ibd_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa  21264041 Dec 21 13:04 ibd_report_awk_processed.genome.tsv.gz
drwxrwxr-x 2 dftortosa dftortosa      4096 Dec 21 13:04 king_analyses
-rw-rw-r-- 1 dftortosa dftortosa      1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa   1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa   2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa  35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa   2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa    185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa      1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa  34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa   2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex
-rw-rw-r-- 1 dftortosa dftortosa     16404 Dec 21 13:04 pairs_relatdness_before_filtering.png
-rw-rw-r-- 1 dftortosa dftortosa     10391 Dec 21 13:04 pi_hat_hist.png

                  #FID1      IID1  ...      IBS0   KINSHIP
0  combat_ILGSA24-17873  7201JDAS  ...  0.026301  0.146409
1  combat_ILGSA24-17873  7493BVNO  ...  0.016356  0.243733
2  combat_ILGSA24-17873  7496STFO  ...  0.020045  0.231122
3  combat_ILGSA24-17873  8244JHMJ  ...  0.014719  0.258806
4  combat_ILGSA24-17873  9101JBJM  ...  0.016883  0.230080

[5 rows x 8 columns]

# Remove samples with first and second-degree relationship using --king-cutoff #
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.log.
Options in effect:
  --bfile ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates
  --king-cutoff 0.088
  --make-bed
  --out ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related

Start time: Sat Dec 21 13:04:32 2024
63997 MiB RAM detected, ~55489 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1416 samples (190 females, 1184 males, 42 ambiguous; 1416 founders) loaded from
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.fam.
289148 variants loaded from
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.bim.
Note: No phenotype data present.
Excluding 17847 variants on non-autosomes from KING-robust calculation.
--king-cutoff pass 1/1: Scanning for rare variants... 0%24%48%72%96%done.
0 variants handled by initial scan (271301 remaining).

--king-cutoff pass 1/1: 0 variants complete.
--king-cutoff pass 1/1: 1536 variants complete.
--king-cutoff pass 1/1: 3072 variants complete.
--king-cutoff pass 1/1: 4608 variants complete.
--king-cutoff pass 1/1: 6144 variants complete.
--king-cutoff pass 1/1: 7680 variants complete.
--king-cutoff pass 1/1: 9216 variants complete.
--king-cutoff pass 1/1: 10752 variants complete.
--king-cutoff pass 1/1: 12288 variants complete.
--king-cutoff pass 1/1: 13824 variants complete.
--king-cutoff pass 1/1: 15360 variants complete.
--king-cutoff pass 1/1: 16896 variants complete.
--king-cutoff pass 1/1: 18432 variants complete.
--king-cutoff pass 1/1: 19968 variants complete.
--king-cutoff pass 1/1: 21504 variants complete.
--king-cutoff pass 1/1: 23040 variants complete.
--king-cutoff pass 1/1: 24576 variants complete.
--king-cutoff pass 1/1: 26112 variants complete.
--king-cutoff pass 1/1: 27648 variants complete.
--king-cutoff pass 1/1: 29184 variants complete.
--king-cutoff pass 1/1: 30720 variants complete.
--king-cutoff pass 1/1: 32256 variants complete.
--king-cutoff pass 1/1: 33792 variants complete.
--king-cutoff pass 1/1: 35328 variants complete.
--king-cutoff pass 1/1: 36864 variants complete.
--king-cutoff pass 1/1: 38400 variants complete.
--king-cutoff pass 1/1: 39936 variants complete.
--king-cutoff pass 1/1: 41472 variants complete.
--king-cutoff pass 1/1: 43008 variants complete.
--king-cutoff pass 1/1: 44544 variants complete.
--king-cutoff pass 1/1: 46080 variants complete.
--king-cutoff pass 1/1: 47616 variants complete.
--king-cutoff pass 1/1: 49152 variants complete.
--king-cutoff pass 1/1: 50688 variants complete.
--king-cutoff pass 1/1: 52224 variants complete.
--king-cutoff pass 1/1: 53760 variants complete.
--king-cutoff pass 1/1: 55296 variants complete.
--king-cutoff pass 1/1: 56832 variants complete.
--king-cutoff pass 1/1: 58368 variants complete.
--king-cutoff pass 1/1: 59904 variants complete.
--king-cutoff pass 1/1: 61440 variants complete.
--king-cutoff pass 1/1: 62976 variants complete.
--king-cutoff pass 1/1: 64512 variants complete.
--king-cutoff pass 1/1: 66048 variants complete.
--king-cutoff pass 1/1: 67584 variants complete.
--king-cutoff pass 1/1: 69120 variants complete.
--king-cutoff pass 1/1: 70656 variants complete.
--king-cutoff pass 1/1: 72192 variants complete.
--king-cutoff pass 1/1: 73728 variants complete.
--king-cutoff pass 1/1: 75264 variants complete.
--king-cutoff pass 1/1: 76800 variants complete.
--king-cutoff pass 1/1: 78336 variants complete.
--king-cutoff pass 1/1: 79872 variants complete.
--king-cutoff pass 1/1: 81408 variants complete.
--king-cutoff pass 1/1: 82944 variants complete.
--king-cutoff pass 1/1: 84480 variants complete.
--king-cutoff pass 1/1: 86016 variants complete.
--king-cutoff pass 1/1: 87552 variants complete.
--king-cutoff pass 1/1: 89088 variants complete.
--king-cutoff pass 1/1: 90624 variants complete.
--king-cutoff pass 1/1: 92160 variants complete.
--king-cutoff pass 1/1: 93696 variants complete.
--king-cutoff pass 1/1: 95232 variants complete.
--king-cutoff pass 1/1: 96768 variants complete.
--king-cutoff pass 1/1: 98304 variants complete.
--king-cutoff pass 1/1: 99840 variants complete.
--king-cutoff pass 1/1: 101376 variants complete.
--king-cutoff pass 1/1: 102912 variants complete.
--king-cutoff pass 1/1: 104448 variants complete.
--king-cutoff pass 1/1: 105984 variants complete.
--king-cutoff pass 1/1: 107520 variants complete.
--king-cutoff pass 1/1: 109056 variants complete.
--king-cutoff pass 1/1: 110592 variants complete.
--king-cutoff pass 1/1: 112128 variants complete.
--king-cutoff pass 1/1: 113664 variants complete.
--king-cutoff pass 1/1: 115200 variants complete.
--king-cutoff pass 1/1: 116736 variants complete.
--king-cutoff pass 1/1: 118272 variants complete.
--king-cutoff pass 1/1: 119808 variants complete.
--king-cutoff pass 1/1: 121344 variants complete.
--king-cutoff pass 1/1: 122880 variants complete.
--king-cutoff pass 1/1: 124416 variants complete.
--king-cutoff pass 1/1: 125952 variants complete.
--king-cutoff pass 1/1: 127488 variants complete.
--king-cutoff pass 1/1: 129024 variants complete.
--king-cutoff pass 1/1: 130560 variants complete.
--king-cutoff pass 1/1: 132096 variants complete.
--king-cutoff pass 1/1: 133632 variants complete.
--king-cutoff pass 1/1: 135168 variants complete.
--king-cutoff pass 1/1: 136704 variants complete.
--king-cutoff pass 1/1: 138240 variants complete.
--king-cutoff pass 1/1: 139776 variants complete.
--king-cutoff pass 1/1: 141312 variants complete.
--king-cutoff pass 1/1: 142848 variants complete.
--king-cutoff pass 1/1: 144384 variants complete.
--king-cutoff pass 1/1: 145920 variants complete.
--king-cutoff pass 1/1: 147456 variants complete.
--king-cutoff pass 1/1: 148992 variants complete.
--king-cutoff pass 1/1: 150528 variants complete.
--king-cutoff pass 1/1: 152064 variants complete.
--king-cutoff pass 1/1: 153600 variants complete.
--king-cutoff pass 1/1: 155136 variants complete.
--king-cutoff pass 1/1: 156672 variants complete.
--king-cutoff pass 1/1: 158208 variants complete.
--king-cutoff pass 1/1: 159744 variants complete.
--king-cutoff pass 1/1: 161280 variants complete.
--king-cutoff pass 1/1: 162816 variants complete.
--king-cutoff pass 1/1: 164352 variants complete.
--king-cutoff pass 1/1: 165888 variants complete.
--king-cutoff pass 1/1: 167424 variants complete.
--king-cutoff pass 1/1: 168960 variants complete.
--king-cutoff pass 1/1: 170496 variants complete.
--king-cutoff pass 1/1: 172032 variants complete.
--king-cutoff pass 1/1: 173568 variants complete.
--king-cutoff pass 1/1: 175104 variants complete.
--king-cutoff pass 1/1: 176640 variants complete.
--king-cutoff pass 1/1: 178176 variants complete.
--king-cutoff pass 1/1: 179712 variants complete.
--king-cutoff pass 1/1: 181248 variants complete.
--king-cutoff pass 1/1: 182784 variants complete.
--king-cutoff pass 1/1: 184320 variants complete.
--king-cutoff pass 1/1: 185856 variants complete.
--king-cutoff pass 1/1: 187392 variants complete.
--king-cutoff pass 1/1: 188928 variants complete.
--king-cutoff pass 1/1: 190464 variants complete.
--king-cutoff pass 1/1: 192000 variants complete.
--king-cutoff pass 1/1: 193536 variants complete.
--king-cutoff pass 1/1: 195072 variants complete.
--king-cutoff pass 1/1: 196608 variants complete.
--king-cutoff pass 1/1: 198144 variants complete.
--king-cutoff pass 1/1: 199680 variants complete.
--king-cutoff pass 1/1: 201216 variants complete.
--king-cutoff pass 1/1: 202752 variants complete.
--king-cutoff pass 1/1: 204288 variants complete.
--king-cutoff pass 1/1: 205824 variants complete.
--king-cutoff pass 1/1: 207360 variants complete.
--king-cutoff pass 1/1: 208896 variants complete.
--king-cutoff pass 1/1: 210432 variants complete.
--king-cutoff pass 1/1: 211968 variants complete.
--king-cutoff pass 1/1: 213504 variants complete.
--king-cutoff pass 1/1: 215040 variants complete.
--king-cutoff pass 1/1: 216576 variants complete.
--king-cutoff pass 1/1: 218112 variants complete.
--king-cutoff pass 1/1: 219648 variants complete.
--king-cutoff pass 1/1: 221184 variants complete.
--king-cutoff pass 1/1: 222720 variants complete.
--king-cutoff pass 1/1: 224256 variants complete.
--king-cutoff pass 1/1: 225792 variants complete.
--king-cutoff pass 1/1: 227328 variants complete.
--king-cutoff pass 1/1: 228864 variants complete.
--king-cutoff pass 1/1: 230400 variants complete.
--king-cutoff pass 1/1: 231936 variants complete.
--king-cutoff pass 1/1: 233472 variants complete.
--king-cutoff pass 1/1: 235008 variants complete.
--king-cutoff pass 1/1: 236544 variants complete.
--king-cutoff pass 1/1: 238080 variants complete.
--king-cutoff pass 1/1: 239616 variants complete.
--king-cutoff pass 1/1: 241152 variants complete.
--king-cutoff pass 1/1: 242688 variants complete.
--king-cutoff pass 1/1: 244224 variants complete.
--king-cutoff pass 1/1: 245760 variants complete.
--king-cutoff pass 1/1: 247296 variants complete.
--king-cutoff pass 1/1: 248832 variants complete.
--king-cutoff pass 1/1: 250368 variants complete.
--king-cutoff pass 1/1: 251904 variants complete.
--king-cutoff pass 1/1: 253440 variants complete.
--king-cutoff pass 1/1: 254976 variants complete.
--king-cutoff pass 1/1: 256512 variants complete.
--king-cutoff pass 1/1: 258048 variants complete.
--king-cutoff pass 1/1: 259584 variants complete.
--king-cutoff pass 1/1: 261120 variants complete.
--king-cutoff pass 1/1: 262656 variants complete.
--king-cutoff pass 1/1: 264192 variants complete.
--king-cutoff pass 1/1: 265728 variants complete.
--king-cutoff pass 1/1: 267264 variants complete.
--king-cutoff pass 1/1: 268800 variants complete.
--king-cutoff pass 1/1: 270336 variants complete.
--king-cutoff pass 1/1: Condensing...                 done.
--king-cutoff: 271301 variants processed.
--king-cutoff: Excluded sample IDs written to
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.king.cutoff.out.id
, and 1411 remaining sample IDs written to
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.king.cutoff.in.id
.
Writing
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.fam
... done.
Writing
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.bim
... done.
Writing
./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.bed
... 0%22%45%67%90%done.
End time: Sat Dec 21 13:04:33 2024
total 216876
-rw-rw-r-- 1 dftortosa dftortosa       900 Dec 21 13:04 id_samples_duplicates.txt
-rw-rw-r-- 1 dftortosa dftortosa      1770 Dec 21 13:04 king_table.kin0
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 king_table.log
-rw-rw-r-- 1 dftortosa dftortosa       519 Dec 21 13:04 king_table_after_dups.kin0
-rw-rw-r-- 1 dftortosa dftortosa      1493 Dec 21 13:04 king_table_after_dups.log
-rw-rw-r-- 1 dftortosa dftortosa 102358395 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.bed
-rw-rw-r-- 1 dftortosa dftortosa   8340840 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.bim
-rw-rw-r-- 1 dftortosa dftortosa     55224 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.fam
-rw-rw-r-- 1 dftortosa dftortosa    785187 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.hh
-rw-rw-r-- 1 dftortosa dftortosa      1920 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates.nosex
-rw-rw-r-- 1 dftortosa dftortosa 102069247 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.bed
-rw-rw-r-- 1 dftortosa dftortosa   8323031 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.bim
-rw-rw-r-- 1 dftortosa dftortosa     55029 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.fam
-rw-rw-r-- 1 dftortosa dftortosa     42339 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.king.cutoff.in.id
-rw-rw-r-- 1 dftortosa dftortosa       159 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.king.cutoff.out.id
-rw-rw-r-- 1 dftortosa dftortosa      2072 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.log

see the samples removed in the last filter
                   #FID       IID
0  combat_ILGSA24-17873  7201JDAS
1  combat_ILGSA24-17873  7493BVNO
2  combat_ILGSA24-17873  7496STFO
3  combat_ILGSA24-17873  8244JHMJ
4  combat_ILGSA24-17873  9101JBJM

# compare the number of removed samples with the total number of problematic samples #
The number of samples filtered out due to relatedness is: 35

###### apply again the MAF and missing filters ######

## create a folder to save plink data after new filters ##
total 52
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 08_remove_low_call_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 09_remove_high_LogRDev_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 10_remove_low_maf_snps
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 11_remove_related_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 12_loop_maf_missing


## create missing and freq reports ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.log.
Options in effect:
  --bfile ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related
  --freq
  --missing
  --out ./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related

63997 MB RAM detected; reserving 31998 MB for main workspace.
289148 variants loaded from .bim file.
1411 people (1179 males, 190 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.nosex
.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1411 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.99953.
--freq: Allele frequencies (founders only) written to
./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.frq
.
--missing: Sample missing data report written to
./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.imiss,
and variant-based missing data report written to
./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.lmiss.
total 52
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 08_remove_low_call_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 09_remove_high_LogRDev_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 10_remove_low_maf_snps
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 11_remove_related_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 12_loop_maf_missing

Warning: 19349 het. haploid genotypes present (see
./12_loop_maf_missing/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.hh
); many commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## check if we have SNPs below the MAF threshold after removing samples ##
764

We have 764 SNPs below the MAF threshold after the first round of filters

## check if we have SNPs below the missing threshold after removing samples ##


We have 0 SNPs above the missing threshold after the first round of filters

## repeat the filters if these snps exists ##

# apply MAF and missing SNP filters #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./12_loop_maf_missing/loop_maf_missing_1.log.
Options in effect:
  --bfile ./11_remove_related_samples/king_analyses/merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related
  --geno 0.01
  --maf 0.05
  --make-bed
  --out ./12_loop_maf_missing/loop_maf_missing_1

63997 MB RAM detected; reserving 31998 MB for main workspace.
289148 variants loaded from .bim file.
1411 people (1179 males, 190 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to ./12_loop_maf_missing/loop_maf_missing_1.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1411 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.99953.
0 variants removed due to missing genotype data (--geno).
764 variants removed due to minor allele threshold(s)
(--maf/--max-maf/--mac/--max-mac).
288384 variants and 1411 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./12_loop_maf_missing/loop_maf_missing_1.bed +
./12_loop_maf_missing/loop_maf_missing_1.bim +
./12_loop_maf_missing/loop_maf_missing_1.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 146292
-rw-rw-r-- 1 dftortosa dftortosa 101799555 Dec 21 13:04 loop_maf_missing_1.bed
-rw-rw-r-- 1 dftortosa dftortosa   8317213 Dec 21 13:04 loop_maf_missing_1.bim
-rw-rw-r-- 1 dftortosa dftortosa     55029 Dec 21 13:04 loop_maf_missing_1.fam
-rw-rw-r-- 1 dftortosa dftortosa    784692 Dec 21 13:04 loop_maf_missing_1.hh
-rw-rw-r-- 1 dftortosa dftortosa      1660 Dec 21 13:04 loop_maf_missing_1.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 loop_maf_missing_1.nosex
-rw-r--r-- 1 dftortosa dftortosa  19662132 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.frq
-rw-rw-r-- 1 dftortosa dftortosa    784692 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.hh
-rw-r--r-- 1 dftortosa dftortosa    102855 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.imiss
-rw-r--r-- 1 dftortosa dftortosa  18262729 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1808 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.nosex

Warning: 19349 het. haploid genotypes present (see
./12_loop_maf_missing/loop_maf_missing_1.hh ); many commands treat these as
missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# apply missing sample filters #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./12_loop_maf_missing/loop_maf_missing_2.log.
Options in effect:
  --bfile ./12_loop_maf_missing/loop_maf_missing_1
  --make-bed
  --mind 0.01
  --out ./12_loop_maf_missing/loop_maf_missing_2

63997 MB RAM detected; reserving 31998 MB for main workspace.
288384 variants loaded from .bim file.
1411 people (1179 males, 190 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to ./12_loop_maf_missing/loop_maf_missing_2.nosex .
0 people removed due to missing genotype data (--mind).
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1411 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.99953.
288384 variants and 1411 people pass filters and QC.
Note: No phenotypes present.
--make-bed to ./12_loop_maf_missing/loop_maf_missing_2.bed +
./12_loop_maf_missing/loop_maf_missing_2.bim +
./12_loop_maf_missing/loop_maf_missing_2.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 254664
-rw-rw-r-- 1 dftortosa dftortosa 101799555 Dec 21 13:04 loop_maf_missing_1.bed
-rw-rw-r-- 1 dftortosa dftortosa   8317213 Dec 21 13:04 loop_maf_missing_1.bim
-rw-rw-r-- 1 dftortosa dftortosa     55029 Dec 21 13:04 loop_maf_missing_1.fam
-rw-rw-r-- 1 dftortosa dftortosa    784692 Dec 21 13:04 loop_maf_missing_1.hh
-rw-rw-r-- 1 dftortosa dftortosa      1660 Dec 21 13:04 loop_maf_missing_1.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 loop_maf_missing_1.nosex
-rw-rw-r-- 1 dftortosa dftortosa 101799555 Dec 21 13:04 loop_maf_missing_2.bed
-rw-rw-r-- 1 dftortosa dftortosa   8317213 Dec 21 13:04 loop_maf_missing_2.bim
-rw-rw-r-- 1 dftortosa dftortosa     55029 Dec 21 13:04 loop_maf_missing_2.fam
-rw-rw-r-- 1 dftortosa dftortosa    784285 Dec 21 13:04 loop_maf_missing_2.hh
-rw-rw-r-- 1 dftortosa dftortosa      1492 Dec 21 13:04 loop_maf_missing_2.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 loop_maf_missing_2.nosex
-rw-r--r-- 1 dftortosa dftortosa  19662132 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.frq
-rw-rw-r-- 1 dftortosa dftortosa    784692 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.hh
-rw-r--r-- 1 dftortosa dftortosa    102855 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.imiss
-rw-r--r-- 1 dftortosa dftortosa  18262729 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1808 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.nosex

Warning: 19339 het. haploid genotypes present (see
./12_loop_maf_missing/loop_maf_missing_2.hh ); many commands treat these as
missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# create MAF and missing reports #
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to loop_maf_missing_2_reports.log.
Options in effect:
  --bfile loop_maf_missing_2
  --freq
  --missing
  --out loop_maf_missing_2_reports

63997 MB RAM detected; reserving 31998 MB for main workspace.
288384 variants loaded from .bim file.
1411 people (1179 males, 190 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to loop_maf_missing_2_reports.nosex .
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1411 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.99953.
--freq: Allele frequencies (founders only) written to
loop_maf_missing_2_reports.frq .
--missing: Sample missing data report written to
loop_maf_missing_2_reports.imiss, and variant-based missing data report written
to loop_maf_missing_2_reports.lmiss.
total 292484
-rw-rw-r-- 1 dftortosa dftortosa 101799555 Dec 21 13:04 loop_maf_missing_1.bed
-rw-rw-r-- 1 dftortosa dftortosa   8317213 Dec 21 13:04 loop_maf_missing_1.bim
-rw-rw-r-- 1 dftortosa dftortosa     55029 Dec 21 13:04 loop_maf_missing_1.fam
-rw-rw-r-- 1 dftortosa dftortosa    784692 Dec 21 13:04 loop_maf_missing_1.hh
-rw-rw-r-- 1 dftortosa dftortosa      1660 Dec 21 13:04 loop_maf_missing_1.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 loop_maf_missing_1.nosex
-rw-rw-r-- 1 dftortosa dftortosa 101799555 Dec 21 13:04 loop_maf_missing_2.bed
-rw-rw-r-- 1 dftortosa dftortosa   8317213 Dec 21 13:04 loop_maf_missing_2.bim
-rw-rw-r-- 1 dftortosa dftortosa     55029 Dec 21 13:04 loop_maf_missing_2.fam
-rw-rw-r-- 1 dftortosa dftortosa    784285 Dec 21 13:04 loop_maf_missing_2.hh
-rw-rw-r-- 1 dftortosa dftortosa      1492 Dec 21 13:04 loop_maf_missing_2.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 loop_maf_missing_2.nosex
-rw-r--r-- 1 dftortosa dftortosa  19610180 Dec 21 13:04 loop_maf_missing_2_reports.frq
-rw-rw-r-- 1 dftortosa dftortosa    784285 Dec 21 13:04 loop_maf_missing_2_reports.hh
-rw-r--r-- 1 dftortosa dftortosa    102842 Dec 21 13:04 loop_maf_missing_2_reports.imiss
-rw-r--r-- 1 dftortosa dftortosa  18214499 Dec 21 13:04 loop_maf_missing_2_reports.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1394 Dec 21 13:04 loop_maf_missing_2_reports.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 loop_maf_missing_2_reports.nosex
-rw-r--r-- 1 dftortosa dftortosa  19662132 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.frq
-rw-rw-r-- 1 dftortosa dftortosa    784692 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.hh
-rw-r--r-- 1 dftortosa dftortosa    102855 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.imiss
-rw-r--r-- 1 dftortosa dftortosa  18262729 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.lmiss
-rw-rw-r-- 1 dftortosa dftortosa      1808 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_duplicates_related.nosex

Warning: 19339 het. haploid genotypes present (see
loop_maf_missing_2_reports.hh ); many commands treat these as missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


# check reports again #


We have 0 SNPs below the MAF threshold after the second round of filters


We have 0 SNPs above the missing threshold after the second round of filters


We have 0 Samples above the missing threshold after the second round of filters

# stop if we still have SNPs/samples not meeting the filters #

## just copy plink files if no filter is required ##
Step not required.

###### visualize heterozygosity ######

## create folder for this step ##
total 56
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 08_remove_low_call_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 09_remove_high_LogRDev_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 10_remove_low_maf_snps
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 11_remove_related_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 12_loop_maf_missing
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 13_visual_hetero


## calculate heterozygosity and missing reports per sample ##
PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./13_visual_hetero/loop_maf_missing_2_hetero.log.
Options in effect:
  --bfile ./12_loop_maf_missing/loop_maf_missing_2
  --het
  --missing
  --out ./13_visual_hetero/loop_maf_missing_2_hetero

63997 MB RAM detected; reserving 31998 MB for main workspace.
288384 variants loaded from .bim file.
1411 people (1179 males, 190 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to ./13_visual_hetero/loop_maf_missing_2_hetero.nosex
.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1411 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.99953.
--missing: Sample missing data report written to
./13_visual_hetero/loop_maf_missing_2_hetero.imiss, and variant-based missing
data report written to ./13_visual_hetero/loop_maf_missing_2_hetero.lmiss.
288384 variants and 1411 people pass filters and QC.
Note: No phenotypes present.
--het: 270565 variants scanned, report written to
./13_visual_hetero/loop_maf_missing_2_hetero.het .

Warning: 19339 het. haploid genotypes present (see
./13_visual_hetero/loop_maf_missing_2_hetero.hh ); many commands treat these as
missing.
Warning: Nonmissing nonmale Y chromosome genotype(s) present; many commands
treat these as missing.


## process the missing report ##

                       FID       IID MISS_PHENO  N_MISS  N_GENO    F_MISS
0     combat_ILGSA24-17303  0200ADMM          Y      73  288384  0.000253
1     combat_ILGSA24-17303  0200ASJM          Y      84  287973  0.000292
2     combat_ILGSA24-17303  0200BHNM          Y     115  287973  0.000399
3     combat_ILGSA24-17303  0200CBOM          Y     370  288384  0.001283
4     combat_ILGSA24-17303  0200CDFM          Y      66  287973  0.000229
...                    ...       ...        ...     ...     ...       ...
1406  combat_ILGSA24-17873  9693JMNM          Y      54  288384  0.000187
1407  combat_ILGSA24-17873  9696DWFM          Y      63  288384  0.000218
1408  combat_ILGSA24-17873  9697STJM          Y      80  288384  0.000277
1409  combat_ILGSA24-17873  9699DNOM          Y      58  288384  0.000201
1410  combat_ILGSA24-17873  9699ISMM          Y     109  288384  0.000378

[1411 rows x 6 columns]

## process the heterozygosity report ##

                       FID       IID  O(HOM)    E(HOM)   N(NM)         F
0     combat_ILGSA24-17303  0200ADMM  181836  180300.0  270506  0.017300
1     combat_ILGSA24-17303  0200ASJM  179926  180300.0  270493 -0.003758
2     combat_ILGSA24-17303  0200BHNM  181006  180200.0  270460  0.008454
3     combat_ILGSA24-17303  0200CBOM  182296  180100.0  270275  0.024260
4     combat_ILGSA24-17303  0200CDFM  182030  180300.0  270511  0.019430
...                    ...       ...     ...       ...     ...       ...
1406  combat_ILGSA24-17873  9693JMNM  181126  180300.0  270518  0.009346
1407  combat_ILGSA24-17873  9696DWFM  180251  180300.0  270507 -0.000270
1408  combat_ILGSA24-17873  9697STJM  181000  180300.0  270494  0.008129
1409  combat_ILGSA24-17873  9699DNOM  180767  180300.0  270518  0.005368
1410  combat_ILGSA24-17873  9699ISMM  182058  180200.0  270469  0.020040

[1411 rows x 6 columns]

## merge both datasets ##
                       FID       IID MISS_PHENO  ...    E(HOM)   N(NM)         F
0     combat_ILGSA24-17303  0200ADMM          Y  ...  180300.0  270506  0.017300
1     combat_ILGSA24-17303  0200ASJM          Y  ...  180300.0  270493 -0.003758
2     combat_ILGSA24-17303  0200BHNM          Y  ...  180200.0  270460  0.008454
3     combat_ILGSA24-17303  0200CBOM          Y  ...  180100.0  270275  0.024260
4     combat_ILGSA24-17303  0200CDFM          Y  ...  180300.0  270511  0.019430
...                    ...       ...        ...  ...       ...     ...       ...
1406  combat_ILGSA24-17873  9693JMNM          Y  ...  180300.0  270518  0.009346
1407  combat_ILGSA24-17873  9696DWFM          Y  ...  180300.0  270507 -0.000270
1408  combat_ILGSA24-17873  9697STJM          Y  ...  180300.0  270494  0.008129
1409  combat_ILGSA24-17873  9699DNOM          Y  ...  180300.0  270518  0.005368
1410  combat_ILGSA24-17873  9699ISMM          Y  ...  180200.0  270469  0.020040

[1411 rows x 10 columns]

## calculate heterozygosity rate ##

## plot missingness against heterozygosity rate like in page 6 of Ritchies review ##

## see the number of samples above the mean heterozigosity +- 3 standard deviations ##
                       FID       IID MISS_PHENO  ...   N(NM)        F  hetero_rate
60    combat_ILGSA24-17303  2398BCJA          Y  ...  270479 -0.06429     0.355007
131   combat_ILGSA24-17303  6798CJOS          Y  ...  270469 -0.06685     0.355863
433   combat_ILGSA24-17873  2298JVJJ          Y  ...  270465 -0.06323     0.354652
663   combat_ILGSA24-17873  4400JWSA          Y  ...  270490 -0.06336     0.354708
670   combat_ILGSA24-17873  4498WVJA          Y  ...  270474 -0.06750     0.356086
817   combat_ILGSA24-17873  6400NWAA          Y  ...  270365 -0.09058     0.363801
835   combat_ILGSA24-17873  6498KMAA          Y  ...  270489 -0.06741     0.356048
855   combat_ILGSA24-17873  6596WDDA          Y  ...  270437 -0.06615     0.355636
896   combat_ILGSA24-17873  6701ESJS          Y  ...  270409 -0.06344     0.354726
941   combat_ILGSA24-17873  7000CSAS          Y  ...  270496 -0.06379     0.354844
1026  combat_ILGSA24-17873  7299JDJS          Y  ...  270493 -0.06298     0.354575
1087  combat_ILGSA24-17873  7499HLJO          Y  ...  270494 -0.06671     0.355816
1110  combat_ILGSA24-17873  7596JGOO          Y  ...  270465 -0.09124     0.363992

[13 rows x 11 columns]
13
the 97.5% percentile of the heterozigosity for samples above the heterozygosity upper limit correspond with the following percentage with respect to that limit
2.7097175003310383

## see the number of samples below the mean heterozigosity +- 3 standard deviations ##
                       FID       IID MISS_PHENO  ...   N(NM)        F  hetero_rate
18    combat_ILGSA24-17303  0290JKSM          Y  ...  270512  0.11170     0.296297
84    combat_ILGSA24-17303  3496GPOJ          Y  ...  270476  0.16690     0.277899
101   combat_ILGSA24-17303  4494JLJA          Y  ...  270498  0.09820     0.300808
152   combat_ILGSA24-17303  7600HPDO          Y  ...  270483  0.09096     0.303232
224   combat_ILGSA24-17873  0197AMDM          Y  ...  270425  0.11560     0.295006
250   combat_ILGSA24-17873  0300JVSJ          Y  ...  270491  0.13370     0.288963
315   combat_ILGSA24-17873  1270VNJM          Y  ...  270341  0.10460     0.298697
343   combat_ILGSA24-17873  1301JMMM          Y  ...  270469  0.10810     0.297491
399   combat_ILGSA24-17873  2197GAMJ          Y  ...  270317  0.08943     0.303747
424   combat_ILGSA24-17873  2286SIFJ          Y  ...  270482  0.11790     0.294241
442   combat_ILGSA24-17873  2300EBJA          Y  ...  270428  0.13190     0.289563
443   combat_ILGSA24-17873  2300EKNA          Y  ...  270100  0.15170     0.282991
482   combat_ILGSA24-17873  2499BLAA          Y  ...  270478  0.11500     0.295211
486   combat_ILGSA24-17873  2499MLAA          Y  ...  270439  0.08942     0.303747
493   combat_ILGSA24-17873  3300JKAM          Y  ...  270467  0.08401     0.305546
516   combat_ILGSA24-17873  3399DAAM          Y  ...  270463  0.11070     0.296628
596   combat_ILGSA24-17873  3584JLSM          Y  ...  270512  0.11940     0.293739
639   combat_ILGSA24-17873  4178GFSA          Y  ...  270473  0.12760     0.290994
646   combat_ILGSA24-17873  4193DTNJ          Y  ...  270494  0.09904     0.300532
678   combat_ILGSA24-17873  4580YZMA          Y  ...  270476  0.10490     0.298592
697   combat_ILGSA24-17873  5900JKAJ          Y  ...  270437  0.11230     0.296095
822   combat_ILGSA24-17873  6401FHMJ          Y  ...  270519  0.20260     0.265978
826   combat_ILGSA24-17873  6488JTSA          Y  ...  270383  0.08693     0.304572
847   combat_ILGSA24-17873  6580JCFA          Y  ...  270510  0.09311     0.302503
900   combat_ILGSA24-17873  6791JGFS          Y  ...  270358  0.09864     0.300657
934   combat_ILGSA24-17873  6995RCFS          Y  ...  270454  0.10800     0.297552
953   combat_ILGSA24-17873  7094PPDS          Y  ...  270387  0.08531     0.305118
978   combat_ILGSA24-17873  7184DXMS          Y  ...  270400  0.10720     0.297814
979   combat_ILGSA24-17873  7185SNJS          Y  ...  270158  0.11810     0.294209
1006  combat_ILGSA24-17873  7282JTFS          Y  ...  270442  0.10940     0.297073
1029  combat_ILGSA24-17873  7300EHFO          Y  ...  270199  0.09518     0.301844
1058  combat_ILGSA24-17873  7400AGAJ          Y  ...  270208  0.15770     0.280987
1071  combat_ILGSA24-17873  7485PNOO          Y  ...  270242  0.09394     0.302255
1077  combat_ILGSA24-17873  7495SYNO          Y  ...  270449  0.11620     0.294813
1082  combat_ILGSA24-17873  7497SSFJ          Y  ...  270300  0.14130     0.286448
1086  combat_ILGSA24-17873  7498YQOO          Y  ...  270485  0.10410     0.298845
1095  combat_ILGSA24-17873  7501KBFO          Y  ...  269965  0.11190     0.296253
1242  combat_ILGSA24-17873  8145TNJJ          Y  ...  270301  0.09402     0.302208
1257  combat_ILGSA24-17873  8244TCOJ          Y  ...  270460  0.11120     0.296491
1258  combat_ILGSA24-17873  8244VCMJ          Y  ...  270502  0.11580     0.294937
1334  combat_ILGSA24-17873  8698WTFJ          Y  ...  270434  0.08958     0.303675
1354  combat_ILGSA24-17873  8778DAAF          Y  ...  270480  0.10210     0.299497

[42 rows x 11 columns]
42
the 2.5% percentile of the heterozigosity for samples below the heterozygosity lower limit correspond with the following percentage with respect to that limit
9.04120953066138

###### start pop stratificaction analyses to detect individuals that are outliers ######

## start with pca ##

# open folder #
total 60
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 00_snp_duplicates
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 01_chromosome_filtering
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 02_remove_non_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 03_remove_pos_dups
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 04_remove_low_maf_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 05_remove_missing_snps
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 06_first_hwe_filter
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 07_par_problem_cleanup
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 08_remove_low_call_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 09_remove_high_LogRDev_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 10_remove_low_maf_snps
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 11_remove_related_samples
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 12_loop_maf_missing
drwxrwxr-x 2 dftortosa dftortosa 4096 Dec 21 13:04 13_visual_hetero
drwxrwxr-x 3 dftortosa dftortosa 4096 Dec 21 13:04 14_pop_strat


# Filter out snps for the PCA #
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./14_pop_strat/01_pca/ldpruned_pca.log.
Options in effect:
  --bfile ./12_loop_maf_missing/loop_maf_missing_2
  --indep-pairwise 500kb 1 0.2
  --out ./14_pop_strat/01_pca/ldpruned_pca

Start time: Sat Dec 21 13:04:34 2024
63997 MiB RAM detected, ~55607 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1411 samples (190 females, 1179 males, 42 ambiguous; 1411 founders) loaded from
./12_loop_maf_missing/loop_maf_missing_2.fam.
288384 variants loaded from ./12_loop_maf_missing/loop_maf_missing_2.bim.
Note: No phenotype data present.
Calculating allele frequencies... 0%22%45%68%90%done.
--indep-pairwise (26 compute threads): 0%50%189906/288384 variants removed.
Writing...
Variant lists written to ./14_pop_strat/01_pca/ldpruned_pca.prune.in and
./14_pop_strat/01_pca/ldpruned_pca.prune.out .
End time: Sat Dec 21 13:04:34 2024
total 3152
-rw-rw-r-- 1 dftortosa dftortosa    1113 Dec 21 13:04 ldpruned_pca.log
-rw-rw-r-- 1 dftortosa dftortosa 1097193 Dec 21 13:04 ldpruned_pca.prune.in
-rw-rw-r-- 1 dftortosa dftortosa 2121787 Dec 21 13:04 ldpruned_pca.prune.out

PLINK v1.90b7 64-bit (16 Jan 2023)             www.cog-genomics.org/plink/1.9/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./14_pop_strat/01_pca/loop_maf_missing_2_ldprunned_autosome_pca.log.
Options in effect:
  --autosome
  --bfile ./12_loop_maf_missing/loop_maf_missing_2
  --extract ./14_pop_strat/01_pca/ldpruned_pca.prune.in
  --make-bed
  --out ./14_pop_strat/01_pca/loop_maf_missing_2_ldprunned_autosome_pca

63997 MB RAM detected; reserving 31998 MB for main workspace.
270054 out of 288384 variants loaded from .bim file.
1411 people (1179 males, 190 females, 42 ambiguous) loaded from .fam.
Ambiguous sex IDs written to
./14_pop_strat/01_pca/loop_maf_missing_2_ldprunned_autosome_pca.nosex .
--extract: 94854 variants remaining.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 1411 founders and 0 nonfounders present.
Calculating allele frequencies... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99% done.
Total genotyping rate is 0.999576.
94854 variants and 1411 people pass filters and QC.
Note: No phenotypes present.
--make-bed to
./14_pop_strat/01_pca/loop_maf_missing_2_ldprunned_autosome_pca.bed +
./14_pop_strat/01_pca/loop_maf_missing_2_ldprunned_autosome_pca.bim +
./14_pop_strat/01_pca/loop_maf_missing_2_ldprunned_autosome_pca.fam ... 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
total 237136
-rw-rw-r-- 1 dftortosa dftortosa 142084096 Dec 21 13:04 ibd_report.genome
-rw-rw-r-- 1 dftortosa dftortosa      1158 Dec 21 13:04 ibd_report.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 ibd_report.nosex
-rw-rw-r-- 1 dftortosa dftortosa  21264041 Dec 21 13:04 ibd_report_awk_processed.genome.tsv.gz
drwxrwxr-x 2 dftortosa dftortosa      4096 Dec 21 13:04 king_analyses
-rw-rw-r-- 1 dftortosa dftortosa      1227 Dec 21 13:04 ldpruned_snplist.log
-rw-rw-r-- 1 dftortosa dftortosa   1102610 Dec 21 13:04 ldpruned_snplist.prune.in
-rw-rw-r-- 1 dftortosa dftortosa   2126515 Dec 21 13:04 ldpruned_snplist.prune.out
-rw-rw-r-- 1 dftortosa dftortosa  35793839 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bed
-rw-rw-r-- 1 dftortosa dftortosa   2849592 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.fam
-rw-rw-r-- 1 dftortosa dftortosa    185662 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.hh
-rw-rw-r-- 1 dftortosa dftortosa      1804 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned.nosex
-rw-rw-r-- 1 dftortosa dftortosa  34477245 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bed
-rw-rw-r-- 1 dftortosa dftortosa   2742773 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.bim
-rw-rw-r-- 1 dftortosa dftortosa     56394 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.fam
-rw-rw-r-- 1 dftortosa dftortosa      1388 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.log
-rw-rw-r-- 1 dftortosa dftortosa      1260 Dec 21 13:04 merged_batches_hwe_par_callrate_LogRDev_maf_ld_prunned_autosomals.nosex
-rw-rw-r-- 1 dftortosa dftortosa     16404 Dec 21 13:04 pairs_relatdness_before_filtering.png
-rw-rw-r-- 1 dftortosa dftortosa     10391 Dec 21 13:04 pi_hat_hist.png


# checks after filtering #
The number of included autosomal SNPs in linkage equilibrium is 94854
Is this number greater than 93K?
TRUE

All non-autosomals SNPs have been removed from the LD pruned dataset?
TRUE


## run PCA to detect clusters of samples ##

# make the run #
PLINK v2.00a4.2LM 64-bit Intel (31 May 2023)   www.cog-genomics.org/plink/2.0/
(C) 2005-2023 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to ./pca_results.log.
Options in effect:
  --bfile ./loop_maf_missing_2_ldprunned_autosome_pca
  --out ./pca_results
  --pca 20

Start time: Sat Dec 21 13:04:35 2024
63997 MiB RAM detected, ~55516 available; reserving 31998 MiB for main
workspace.
Using up to 32 threads (change this with --threads).
1411 samples (190 females, 1179 males, 42 ambiguous; 1411 founders) loaded from
./loop_maf_missing_2_ldprunned_autosome_pca.fam.
94854 variants loaded from ./loop_maf_missing_2_ldprunned_autosome_pca.bim.
Note: No phenotype data present.
Calculating allele frequencies... 0%69%done.
Constructing GRM: 0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
Correcting for missingness... 0%0%1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%16%17%18%19%20%21%22%23%24%25%26%27%28%29%30%31%32%33%34%35%36%37%38%39%40%41%42%43%44%45%46%47%48%49%50%51%52%53%54%55%56%57%58%59%60%61%62%63%64%65%66%67%68%69%70%71%72%73%74%75%76%77%78%79%80%81%82%83%84%85%86%87%88%89%90%91%92%93%94%95%96%97%98%99%done.
Extracting eigenvalues and eigenvectors... done.
--pca: Eigenvectors written to ./pca_results.eigenvec , and eigenvalues written
to ./pca_results.eigenval .
End time: Sat Dec 21 13:04:37 2024


# load the eigenvec file generated #

# batch effects #
plot the PCA values between batches
check the distribution of the PCs between batches as it should be similar (MannWhitney U test assumption)
make MannWhitney U test for the difference of PC values between batches
      PC  U_statistic         P
0    PC1     130563.5  0.362201
1    PC2     126555.0  0.861941
2    PC3     130229.5  0.395466
3    PC4     129132.0  0.517058
4    PC5     131177.0  0.305826
5    PC6     129374.0  0.488688
6    PC7     125763.0  0.977476
7    PC8     123163.0  0.652858
8    PC9     131388.0  0.287860
9   PC10     123217.0  0.660036
10  PC11     127491.0  0.729297
11  PC12     125745.0  0.980117
12  PC13     124268.5  0.805323
13  PC14     119314.0  0.246972
14  PC15     120860.0  0.382455
15  PC16     124505.0  0.839163
16  PC17     125422.0  0.972636
17  PC18     126777.5  0.829901
18  PC19     121799.0  0.483507
19  PC20     120211.0  0.320831
The wilcoxon test for all the PCs between batches are non-significant. Therefore, we accept the null hypothesis: for randomly selected PC values X and Y from two batches, the probability of X being greater than Y is equal to the probability of Y being greater than X (see code for details)

# select PCs based on explianed variance #
load eigenvalues
            0
P1   28.38150
P2    4.66385
P3    3.77269
P4    2.62852
P5    1.77456
P6    1.72521
P7    1.48682
P8    1.41978
P9    1.34738
P10   1.32275
P11   1.31634
P12   1.30826
P13   1.29845
P14   1.29706
P15   1.29431
P16   1.29357
P17   1.29223
P18   1.28955
P19   1.28896
P20   1.28764
calculate the proportion of explained variance
make de scree plot
see the first PC where cumulative explianed variability reaches 80% of the total
The first PC where cumulative explianed variability reaches 76% of the total is P9 with 0.77 of the total

# PCA with smartpca #
prepare fam file for smartpca

decide the number of axes to output
smartpca parameter file

run smartpca

see significant axes

        #N  eigenvalue  difference   twstat        p-value    effect.
0        1    1.736592         NaN  299.687   0.000000e+00  62622.856
1        2    1.434235   -0.302357   95.522  2.259090e-272  63859.799
2        3    1.309386   -0.124849    9.637   1.745890e-10  64218.030
3        4    1.301056   -0.008330    4.351   1.018080e-04  64342.445
4        5    1.299520   -0.001536    3.786   3.482450e-04  64455.381
...    ...         ...         ...      ...            ...        ...
1234  1235    0.753018   -0.001094      NaN            NaN        NaN
1235  1236    0.750886   -0.002132      NaN            NaN        NaN
1236  1237    0.749245   -0.001641      NaN            NaN        NaN
1237  1238    0.747905   -0.001340      NaN            NaN        NaN
1238  1239    0.746556   -0.001349      NaN            NaN        NaN

[1239 rows x 6 columns]
   #N  eigenvalue  difference   twstat        p-value    effect.
0   1    1.736592         NaN  299.687   0.000000e+00  62622.856
1   2    1.434235   -0.302357   95.522  2.259090e-272  63859.799
2   3    1.309386   -0.124849    9.637   1.745890e-10  64218.030
3   4    1.301056   -0.008330    4.351   1.018080e-04  64342.445
4   5    1.299520   -0.001536    3.786   3.482450e-04  64455.381
5   6    1.295997   -0.003523    1.821   1.398100e-02  64567.361
We have 6 significant axes
plot smartpca eigenvectors

                                 0       1       2   ...      18      19      20
0     combat_ILGSA24-17303:0200ADMM  0.0040 -0.0114  ... -0.0074  0.0085 -0.0052
1     combat_ILGSA24-17303:0200ASJM -0.0704 -0.0905  ... -0.0111 -0.0227  0.0105
2     combat_ILGSA24-17303:0200BHNM  0.0181 -0.0021  ...  0.0259 -0.0016  0.0347
3     combat_ILGSA24-17303:0200CBOM  0.0188  0.0180  ... -0.0042 -0.0221  0.0230
4     combat_ILGSA24-17303:0200CDFM -0.0192  0.0154  ... -0.0293  0.0134 -0.0019
...                             ...     ...     ...  ...     ...     ...     ...
1235  combat_ILGSA24-17873:9693JMNM  0.0047 -0.0226  ...  0.0191  0.0222  0.0011
1236  combat_ILGSA24-17873:9696DWFM  0.0117  0.0112  ...  0.0108 -0.0180 -0.0549
1237  combat_ILGSA24-17873:9697STJM  0.0218 -0.0033  ...  0.0227  0.0008 -0.0030
1238  combat_ILGSA24-17873:9699DNOM -0.0612  0.0506  ... -0.0042 -0.0549 -0.0219
1239  combat_ILGSA24-17873:9699ISMM  0.0043  0.0168  ... -0.0126  0.0074 -0.0130

[1240 rows x 21 columns]
plot the explained variance using eigenvalues
             0
0     1.736592
1     1.434235
2     1.309386
3     1.301056
4     1.299520
...        ...
1235  0.750886
1236  0.749245
1237  0.747905
1238  0.746556
1239  0.000000

[1240 rows x 1 columns]
      eigenvalue  prop_variance
0       1.736592       0.001402
1       1.434235       0.001158
2       1.309386       0.001057
3       1.301056       0.001050
4       1.299520       0.001049
...          ...            ...
1235    0.750886       0.000606
1236    0.749245       0.000605
1237    0.747905       0.000604
1238    0.746556       0.000603
1239    0.000000       0.000000

[1240 rows x 2 columns]
    eigenvalue  prop_variance
0     1.736592       0.001402
1     1.434235       0.001158
2     1.309386       0.001057
3     1.301056       0.001050
4     1.299520       0.001049
5     1.295997       0.001046
6     1.292581       0.001043
7     1.290302       0.001041
8     1.289566       0.001041
9     1.288336       0.001040
10    1.285712       0.001038
11    1.284820       0.001037
12    1.282916       0.001035
13    1.281467       0.001034
14    1.280954       0.001034
15    1.279859       0.001033
16    1.277845       0.001031
17    1.277278       0.001031
18    1.275699       0.001030
19    1.273906       0.001028
plot SNP weights

